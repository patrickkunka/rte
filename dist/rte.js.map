{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 7aa03ab331dea726ef1e","webpack:///./src/factory.js","webpack:///./src/RichTextEditor.js","webpack:///./src/Dom.js","webpack:///./src/Util.js","webpack:///./src/models/Markup.js","webpack:///./src/models/Node.js","webpack:///./src/models/Caret.js","webpack:///./src/models/Range.js","webpack:///./src/models/State.js","webpack:///./src/EventHandler.js","webpack:///./src/Editor.js","webpack:///./src/TreeBuilder.js","webpack:///./src/Renderer.js","webpack:///./tests/data.json"],"names":["factory","el","richTextEditor","attach","module","exports","RichTextEditor","dom","state","eventHandler","root","history","initialState","buildInitialState","buildModelFromState","console","log","render","bindEvents","extend","markups","length","push","map","markup","innerHTML","renderNodes","childNodes","command","content","selection","window","getSelection","range","getRangeFromSelection","fn","Error","newState","positionCaret","from","to","node","path","unshift","index","parentElement","i","anchorPath","getPathFromNode","anchorNode","virtualAnchorNode","getNodeByPath","extentPath","virtualExtentNode","isRtl","rangeFrom","rangeTo","isCollapsed","extentNode","anchorOffset","extentOffset","offset","Math","min","start","end","document","createRange","virtualNode","nodeLeft","nodeRight","offsetStart","offsetEnd","setStart","collapse","setEnd","removeAllRanges","addRange","buildTreeFromRoot","text","Dom","Object","seal","Util","target","source","deep","sourceKeys","TypeError","Array","isArray","keys","key","descriptor","getOwnPropertyDescriptor","get","arr","reduce","prev","curr","concat","interval","immediate","timeoutId","args","arguments","later","apply","clearTimeout","setTimeout","last","now","Date","difference","Infinity","selector","includeSelf","parent","parentNode","matches","body","selectors","split","childSelectors","children","tempId","id","pop","querySelectorAll","join","removeAttribute","includeNonElements","previousSibling","previousElementSibling","str","toLowerCase","replace","$1","toUpperCase","camelCase","charAt","slice","Markup","tag","defineProperties","type","indexOf","isBlock","isInline","Node","isText","Caret","Range","State","EventHandler","delegator","bind","addEventListener","removeEventListener","e","eventType","pascalCase","sanitizeSelection","preventDefault","performCommand","metaKey","shiftKey","altKey","Editor","isRange","characters","totalDeleted","totalAdded","adjustment","collapsed","totalCollapsed","collapseWhitespace","adjustMarkups","fromIndex","toIndex","newMarkups","newMarkup","removeMarkup","nextBlockMarkup","getNextBlockMarkup","TreeBuilder","openNodes","isAtLeaf","requiresNewLeaf","j","closedNode","textNode","closeNode","newNode","getOpenNode","leaf","Renderer","nodes","renderNode","html","match"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;ACtCA;;;;AACA;;;;;;AAEA,UAASA,OAAT,CAAiBC,EAAjB,EAAqB;AACjB,SAAMC,iBAAiB,8BAAvB;;AAEAA,oBAAeC,MAAf,CAAsBF,EAAtB;;AAEA,YAAOC,cAAP;AACH;;AAEDE,QAAOC,OAAP,GAAiBL,OAAjB,C;;;;;;;;;;;;;;;;ACXA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;KAEMM,c;AACF,+BAAc;AAAA;;AACV,cAAKC,GAAL,GAAsB,mBAAtB;AACA,cAAKC,KAAL,GAAsB,qBAAtB;AACA,cAAKC,YAAL,GAAsB,4BAAtB;AACA,cAAKC,IAAL,GAAsB,IAAtB;AACA,cAAKC,OAAL,GAAsB,EAAtB;AACH;;;;gCAEMV,E,EAA8B;AAAA,iBAA1BW,YAA0B,uEAAb,qBAAa;;AACjC,kBAAKL,GAAL,CAASG,IAAT,GAAgBT,EAAhB;;AAEA,kBAAKY,iBAAL,CAAuBD,YAAvB;;AAEA,kBAAKF,IAAL,GAAYJ,eAAeQ,mBAAf,CAAmC,KAAKN,KAAxC,CAAZ;;AAEAO,qBAAQC,GAAR,CAAY,KAAKN,IAAjB;;AAEA,kBAAKO,MAAL;;AAEA,kBAAKR,YAAL,CAAkBS,UAAlB,CAA6B,KAAKX,GAAL,CAASG,IAAtC,EAA4C,IAA5C;AACH;;AAED;;;;;;;2CAKkBE,Y,EAAc;AAC5B,4BAAKO,MAAL,CAAY,KAAKX,KAAjB,EAAwBI,YAAxB;;AAEA,iBAAI,KAAKJ,KAAL,CAAWY,OAAX,CAAmBC,MAAnB,GAA4B,CAAhC,EAAmC;AAC/B,sBAAKb,KAAL,CAAWY,OAAX,CAAmBE,IAAnB,CAAwB,CAAC,GAAD,EAAM,CAAN,EAAS,CAAT,CAAxB;AACH;;AAED,kBAAKd,KAAL,CAAWY,OAAX,GAAqB,KAAKZ,KAAL,CAAWY,OAAX,CAAmBG,GAAnB,CAAuB;AAAA,wBAAU,qBAAWC,MAAX,CAAV;AAAA,cAAvB,CAArB;AACH;;;kCAEQ;AACL,kBAAKjB,GAAL,CAASG,IAAT,CAAce,SAAd,GAA0B,mBAASC,WAAT,CAAqB,KAAKhB,IAAL,CAAUiB,UAA/B,CAA1B;AACH;;;wCAEcC,O,EAASC,O,EAAS;AAC7B,iBAAMC,YAAYC,OAAOC,YAAP,EAAlB;AACA,iBAAMC,QAAQ,KAAKC,qBAAL,CAA2BJ,SAA3B,CAAd;;AAEA,iBAAMK,KAAK,iBAAOP,OAAP,CAAX;;AAEA,iBAAI,OAAOO,EAAP,KAAc,UAAlB,EAA8B;AAC1B,uBAAM,IAAIC,KAAJ,qDAA4DR,OAA5D,OAAN;AACH;;AAED,iBAAMS,WAAWF,GAAG,KAAK3B,KAAR,EAAeyB,KAAf,EAAsBJ,OAAtB,CAAjB;;AAEA,iBAAIQ,aAAa,KAAK7B,KAAtB,EAA6B;;AAE7B,kBAAKG,OAAL,CAAaW,IAAb,CAAkB,KAAKd,KAAvB;;AAEA,kBAAKA,KAAL,GAAa6B,QAAb;;AAEA,kBAAK3B,IAAL,GAAYJ,eAAeQ,mBAAf,CAAmC,KAAKN,KAAxC,CAAZ;;AAEA,kBAAKS,MAAL;;AAEA,kBAAKqB,aAAL,CAAmB,KAAK9B,KAAL,CAAWsB,SAA9B;AACH;;;6CAEmB;AAChB,iBAAMA,YAAYC,OAAOC,YAAP,EAAlB;AACA,iBAAMC,QAAQ,KAAKC,qBAAL,CAA2BJ,SAA3B,CAAd;;AAEAf,qBAAQC,GAAR,CAAYiB,KAAZ;;AAEA,kBAAKK,aAAL,CAAmB,CAACL,MAAMM,IAAP,EAAaN,MAAMO,EAAnB,CAAnB;AACH;;;yCAEeC,I,EAAM;AAClB,iBAAMC,OAAO,EAAb;;AAEA,oBAAOD,QAAQA,SAAS,KAAKlC,GAAL,CAASG,IAAjC,EAAuC;AACnCgC,sBAAKC,OAAL,CAAa,eAAKC,KAAL,CAAWH,IAAX,EAAiB,IAAjB,CAAb;;AAEAA,wBAAOA,KAAKI,aAAZ;AACH;;AAED,oBAAOH,IAAP;AACH;;;uCAEaA,I,EAAMhC,I,EAAM;AACtB,iBAAI+B,OAAO/B,IAAX;AACA,iBAAIkC,QAAQ,CAAC,CAAb;AACA,iBAAIE,IAAI,CAAR;;AAEA,oBAAO,QAAQF,QAAQF,KAAKI,CAAL,CAAhB,MAA6B,QAApC,EAA8C;AAC1CL,wBAAOA,KAAKd,UAAL,CAAgBiB,KAAhB,CAAP;;AAEAE;AACH;;AAED,oBAAOL,QAAQ,IAAf;AACH;;AAED;;;;;;;+CAKsBX,S,EAAW;AAC7B,iBAAMiB,aAAa,KAAKC,eAAL,CAAqBlB,UAAUmB,UAA/B,CAAnB;AACA,iBAAMC,oBAAoB,KAAKC,aAAL,CAAmBJ,UAAnB,EAA+B,KAAKrC,IAApC,CAA1B;AACA,iBAAM6B,OAAO,qBAAb;AACA,iBAAMC,KAAK,qBAAX;;AAEA,iBAAIY,aAAaL,UAAjB;AACA,iBAAIM,oBAAoBH,iBAAxB;AACA,iBAAII,QAAQ,KAAZ;AACA,iBAAIC,YAAY,CAAC,CAAjB;AACA,iBAAIC,UAAU,CAAC,CAAf;;AAEA,iBAAI,CAAC1B,UAAU2B,WAAf,EAA4B;AACxBL,8BAAa,KAAKJ,eAAL,CAAqBlB,UAAU4B,UAA/B,CAAb;AACAL,qCAAoB,KAAKF,aAAL,CAAmBC,UAAnB,EAA+B,KAAK1C,IAApC,CAApB;AACH;;AAED4C,qBAAQF,aAAaL,UAAb,IAA2B,EAAEK,aAAaL,UAAf,KAA8BjB,UAAU6B,YAAV,GAAyB7B,UAAU8B,YAApG;;AAEArB,kBAAKE,IAAL,GAAcD,GAAGC,IAAH,GAAUa,QAAQD,iBAAR,GAA4BH,iBAApD;AACAX,kBAAKsB,MAAL,GAAcrB,GAAGqB,MAAH,GAAYP,QAAQxB,UAAU8B,YAAlB,GAAiC9B,UAAU6B,YAArE;AACApB,kBAAKG,IAAL,GAAcF,GAAGE,IAAH,GAAUY,QAAQF,UAAR,GAAqBL,UAA7C;;AAEA,iBAAI,CAACjB,UAAU2B,WAAf,EAA4B;AACxBjB,oBAAGC,IAAH,GAAca,QAAQJ,iBAAR,GAA4BG,iBAA1C;AACAb,oBAAGqB,MAAH,GAAcP,QAAQxB,UAAU6B,YAAlB,GAAiC7B,UAAU8B,YAAzD;AACApB,oBAAGE,IAAH,GAAcY,QAAQP,UAAR,GAAqBK,UAAnC;AACH;;AAEDG,yBAAYO,KAAKC,GAAL,CAASxB,KAAKE,IAAL,CAAUuB,KAAV,GAAkBzB,KAAKsB,MAAhC,EAAwCtB,KAAKE,IAAL,CAAUwB,GAAlD,CAAZ;AACAT,uBAAUM,KAAKC,GAAL,CAASvB,GAAGC,IAAH,CAAQuB,KAAR,GAAgBxB,GAAGqB,MAA5B,EAAoCrB,GAAGC,IAAH,CAAQwB,GAA5C,CAAV;;AAEA,oBAAO,oBAAUV,SAAV,EAAqBC,OAArB,CAAP;AACH;;;6CAE2B;AAAA;AAAA,iBAAbQ,KAAa;AAAA,iBAANC,GAAM;;AACxB,iBAAMhC,QAAQiC,SAASC,WAAT,EAAd;AACA,iBAAMrC,YAAYC,OAAOC,YAAP,EAAlB;;AAEA,iBAAIL,aAAc,KAAKjB,IAAL,CAAUiB,UAA5B;AACA,iBAAIyC,cAAc,IAAlB;AACA,iBAAIC,WAAc,IAAlB;AACA,iBAAIC,YAAc,IAAlB;AACA,iBAAIC,cAAc,CAAC,CAAnB;AACA,iBAAIC,YAAc,CAAC,CAAnB;;AAEA,kBAAK,IAAI1B,IAAI,CAAb,EAAiBsB,cAAczC,WAAWmB,CAAX,CAA/B,EAA+CA,GAA/C,EAAoD;AAChD;;AAEA,qBAAIsB,YAAYH,GAAZ,GAAkBD,KAAtB,EAA6B;;AAE7B;;AAEA,qBAAII,YAAYzC,UAAZ,CAAuBN,MAA3B,EAAmC;AAC/B;;AAEAM,kCAAayC,YAAYzC,UAAzB;;AAEAmB,yBAAI,CAAC,CAAL;;AAEA;AACH;;AAED;;AAEAyB,+BAAcP,QAAQI,YAAYJ,KAAlC;;AAEA;AACH;;AAEDK,wBAAW,KAAKlB,aAAL,CAAmBiB,YAAY1B,IAA/B,EAAqC,KAAKnC,GAAL,CAASG,IAA9C,CAAX;;AAEAuB,mBAAMwC,QAAN,CAAeJ,QAAf,EAAyBE,WAAzB;;AAEA,iBAAIP,UAAUC,GAAd,EAAmB;AACf;;AAEAhC,uBAAMyC,QAAN,CAAe,IAAf;AACH,cAJD,MAIO;AACH;;AAEA/C,8BAAa,KAAKjB,IAAL,CAAUiB,UAAvB;;AAEA,sBAAK,IAAImB,KAAI,CAAb,EAAiBsB,cAAczC,WAAWmB,EAAX,CAA/B,EAA+CA,IAA/C,EAAoD;AAChD,yBAAIsB,YAAYH,GAAZ,GAAkBA,GAAtB,EAA2B;;AAE3B,yBAAIG,YAAYzC,UAAZ,CAAuBN,MAA3B,EAAmC;AAC/BM,sCAAayC,YAAYzC,UAAzB;;AAEAmB,8BAAI,CAAC,CAAL;;AAEA;AACH;;AAED0B,iCAAYP,MAAMG,YAAYJ,KAA9B;;AAEA;AACH;;AAEDM,6BAAY,KAAKnB,aAAL,CAAmBiB,YAAY1B,IAA/B,EAAqC,KAAKnC,GAAL,CAASG,IAA9C,CAAZ;;AAEAuB,uBAAM0C,MAAN,CAAaL,SAAb,EAAwBE,SAAxB;AACH;;AAED1C,uBAAU8C,eAAV;AACA9C,uBAAU+C,QAAV,CAAmB5C,KAAnB;AACH;;;6CAE0BzB,K,EAAO;AAC9B,iBAAME,OAAO,oBAAb;;AAEA,mCAAYoE,iBAAZ,CAA8BpE,IAA9B,EAAoCF,MAAMuE,IAA1C,EAAgDvE,MAAMY,OAAtD;;AAEA,oBAAOV,IAAP;AACH;;;;;;mBAGUJ,c;;;;;;;;;;;;;;KC5OT0E,G,GACF,eAAc;AAAA;;AACV,UAAKtE,IAAL,GAAY,IAAZ;;AAEAuE,YAAOC,IAAP,CAAY,IAAZ;AACH,E;;mBAGUF,G;;;;;;;;;;;;;;;;;;KCRTG,I;;;;;;;;;AAEF;;;;;;;gCAOcC,M,EAAQC,M,EAAQC,I,EAAM;AAChC,iBAAIC,aAAa,EAAjB;;AAEA,iBAAI,CAACH,MAAD,IAAW,QAAOA,MAAP,yCAAOA,MAAP,OAAkB,QAAjC,EAA2C;AACvC,uBAAM,IAAII,SAAJ,CAAc,6CAAd,CAAN;AACH;;AAEDF,oBAAOA,QAAQ,KAAf;;AAEA,iBAAIG,MAAMC,OAAN,CAAcL,MAAd,CAAJ,EAA2B;AACvB,sBAAK,IAAIvC,IAAI,CAAb,EAAgBA,IAAIuC,OAAOhE,MAA3B,EAAmCyB,GAAnC,EAAwC;AACpCyC,gCAAWjE,IAAX,CAAgBwB,CAAhB;AACH;AACJ,cAJD,MAIO,IAAIuC,MAAJ,EAAY;AACfE,8BAAaN,OAAOU,IAAP,CAAYN,MAAZ,CAAb;AACH;;AAED,kBAAK,IAAIvC,KAAI,CAAb,EAAgBA,KAAIyC,WAAWlE,MAA/B,EAAuCyB,IAAvC,EAA4C;AACxC,qBAAI8C,MAAML,WAAWzC,EAAX,CAAV;AACA,qBAAI+C,aAAaZ,OAAOa,wBAAP,CAAgCT,MAAhC,EAAwCO,GAAxC,CAAjB;;AAEA;;AAEA,qBAAI,OAAOC,WAAWE,GAAlB,KAA0B,UAA9B,EAA0C;;AAE1C,qBAAI,CAACT,IAAD,IAAS,QAAOD,OAAOO,GAAP,CAAP,MAAuB,QAApC,EAA8C;AAC1C;AACA;;AAEAR,4BAAOQ,GAAP,IAAcP,OAAOO,GAAP,CAAd;AACH,kBALD,MAKO,IAAIH,MAAMC,OAAN,CAAcL,OAAOO,GAAP,CAAd,CAAJ,EAAgC;AACnC;;AAEA,yBAAI,CAACR,OAAOQ,GAAP,CAAL,EAAkB;AACdR,gCAAOQ,GAAP,IAAc,EAAd;AACH;;AAED,0BAAKzE,MAAL,CAAYiE,OAAOQ,GAAP,CAAZ,EAAyBP,OAAOO,GAAP,CAAzB,EAAsCN,IAAtC;AACH,kBARM,MAQA;AACH;;AAEA,yBAAI,CAACF,OAAOQ,GAAP,CAAL,EAAkB;AACdR,gCAAOQ,GAAP,IAAc,EAAd;AACH;;AAED,0BAAKzE,MAAL,CAAYiE,OAAOQ,GAAP,CAAZ,EAAyBP,OAAOO,GAAP,CAAzB,EAAsCN,IAAtC;AACH;AACJ;;AAED,oBAAOF,MAAP;AACH;;AAED;;;;;;;;;sCAOoBY,G,EAAK;AACrB,oBAAOA,IAAIC,MAAJ,CAAW,UAACC,IAAD,EAAOC,IAAP,EAAgB;AAC9B,qBAAIV,MAAMC,OAAN,CAAcS,IAAd,CAAJ,EAAyB;AACrB,4BAAOD,KAAKE,MAAL,CAAYD,IAAZ,CAAP;AACH;;AAEDD,sBAAK5E,IAAL,CAAU6E,IAAV;;AAEA,wBAAOD,IAAP;AACH,cARM,EAQJ,EARI,CAAP;AASH;;AAED;;;;;;;;;;;;;;;kCAagB/D,E,EAAIkE,Q,EAAUC,S,EAAW;AACrC,iBAAIC,YAAY,CAAC,CAAjB;;AAEA,oBAAO,YAAW;AAAA;;AACd,qBAAMC,OAAOC,SAAb;;AAEA,qBAAMC,QAAQ,SAARA,KAAQ,GAAM;AAChBH,iCAAY,CAAC,CAAb;;AAEApE,wBAAGwE,KAAH,QAAeH,IAAf,EAHgB,CAGM;AACzB,kBAJD;;AAMA,qBAAID,YAAY,CAAZ,IAAiBD,SAArB,EAAgC;AAC5BI;AACH,kBAFD,MAEO;AACHE,kCAAaL,SAAb;;AAEAA,iCAAYM,WAAWH,KAAX,EAAkBL,QAAlB,CAAZ;AACH;AACJ,cAhBD;AAiBH;;AAED;;;;;;;;;;;kCASgBlE,E,EAAIkE,Q,EAAU;AAC1B,iBAAIE,YAAY,CAAC,CAAjB;AACA,iBAAIO,OAAO,CAAC,CAAZ;;AAEA,oBAAO,YAAW;AAAA;;AACd,qBAAMN,OAAOC,SAAb;AACA,qBAAMM,MAAMC,KAAKD,GAAL,EAAZ;AACA,qBAAME,aAAaH,OAAOC,MAAMD,IAAb,GAAoBI,QAAvC;;AAEA,qBAAMR,QAAQ,SAARA,KAAQ,GAAM;AAChBI,4BAAOC,GAAP;;AAEA5E,wBAAGwE,KAAH,SAAeH,IAAf,EAHgB,CAGM;AACzB,kBAJD;;AAMA,qBAAI,CAACM,IAAD,IAASG,cAAcZ,QAA3B,EAAqC;AACjCK;AACH,kBAFD,MAEO;AACHE,kCAAaL,SAAb;;AAEAA,iCAAYM,WAAWH,KAAX,EAAkBL,WAAWY,UAA7B,CAAZ;AACH;AACJ,cAlBD;AAmBH;;AAED;;;;;;;;;uCAOqBhH,E,EAAIkH,Q,EAAUC,W,EAAa;AAC5C,iBAAIC,SAASpH,GAAGqH,UAAhB;;AAEA,iBAAIF,eAAenH,GAAGsH,OAAH,CAAWJ,QAAX,CAAnB,EAAyC;AACrC,wBAAOlH,EAAP;AACH;;AAED,oBAAOoH,UAAUA,WAAWnD,SAASsD,IAArC,EAA2C;AACvC,qBAAIH,OAAOE,OAAP,IAAkBF,OAAOE,OAAP,CAAeJ,QAAf,CAAtB,EAAgD;AAC5C,4BAAOE,MAAP;AACH,kBAFD,MAEO,IAAIA,OAAOC,UAAX,EAAuB;AAC1BD,8BAASA,OAAOC,UAAhB;AACH,kBAFM,MAEA;AACH,4BAAO,IAAP;AACH;AACJ;;AAED,oBAAO,IAAP;AACH;;AAED;;;;;;;;kCAMgBrH,E,EAAIkH,Q,EAAU;AAC1B,iBAAMM,YAAYN,SAASO,KAAT,CAAe,GAAf,CAAlB;AACA,iBAAMC,iBAAiB,EAAvB;;AAEA,iBAAIC,WAAW,IAAf;AACA,iBAAIC,SAAW,EAAf;;AAEA,iBAAI,CAAC5H,GAAG6H,EAAR,EAAY;AACRD,0BAAS,QAAT;;AAEA5H,oBAAG6H,EAAH,GAAQD,MAAR;AACH;;AAED,oBAAOJ,UAAUpG,MAAjB,EAAyB;AACrBsG,gCAAerG,IAAf,CAAoB,MAAMrB,GAAG6H,EAAT,GAAc,GAAd,GAAoBL,UAAUM,GAAV,EAAxC;AACH;;AAEDH,wBAAW1D,SAAS8D,gBAAT,CAA0BL,eAAeM,IAAf,CAAoB,IAApB,CAA1B,CAAX;;AAEA,iBAAIJ,MAAJ,EAAY;AACR5H,oBAAGiI,eAAH,CAAmB,IAAnB;AACH;;AAED,oBAAON,QAAP;AACH;;AAED;;;;;;;;+BAManF,I,EAAgC;AAAA,iBAA1B0F,kBAA0B,uEAAP,KAAO;;AACzC,iBAAIvF,QAAQ,CAAZ;;AAEA,oBAAO,CAACH,OAAO0F,qBAAqB1F,KAAK2F,eAA1B,GAA4C3F,KAAK4F,sBAAzD,MAAqF,IAA5F,EAAkG;AAC9FzF;AACH;;AAED,oBAAOA,KAAP;AACH;;AAED;;;;;;;;;mCAOiB0F,G,EAAK;AAClB,oBAAOA,IAAIC,WAAJ,GACFC,OADE,CACM,iBADN,EACyB;AAAA,wBAAMC,GAAGC,WAAH,GAAiBF,OAAjB,CAAyB,MAAzB,EAAiC,EAAjC,CAAN;AAAA,cADzB,CAAP;AAEH;;AAED;;;;;;;;;oCAOkBF,G,EAAK;AACnB,oBAAO,CAACA,MAAMnD,KAAKwD,SAAL,CAAeL,GAAf,CAAP,EACFM,MADE,CACK,CADL,EAEFF,WAFE,KAEcJ,IAAIO,KAAJ,CAAU,CAAV,CAFrB;AAGH;;AAED;;;;;;;;;kCAOgBP,G,EAAK;AACjB,oBAAOA,IAAIE,OAAJ,CAAY,UAAZ,EAAwB,KAAxB,EACFA,OADE,CACM,IADN,EACY,EADZ,EAEFD,WAFE,EAAP;AAGH;;;;;;mBAGUpD,I;;;;;;;;;;;;;;;;;;;;KCvQT2D,M;;;AACF,2BAA+B;AAAA;AAAA,aAAlBC,GAAkB;AAAA,aAAb/E,KAAa;AAAA,aAANC,GAAM;;AAAA;;AAAA;;AAG3B,eAAK,CAAL,IAAU8E,GAAV;AACA,eAAK,CAAL,IAAU/E,KAAV;AACA,eAAK,CAAL,IAAUC,GAAV;;AAEAgB,gBAAO+D,gBAAP,QAA8B;AAC1BC,mBAAM;AACFlD,oBADE,iBACI;AACF,4BAAO,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,GAArC,EAA0CmD,OAA1C,CAAkD,KAAK,CAAL,CAAlD,IAA6D,CAAC,CAA9D,GAAkE,OAAlE,GAA4E,QAAnF;AACH;AAHC,cADoB;AAM1BC,sBAAS;AACLpD,oBADK,iBACC;AACF,4BAAO,KAAKkD,IAAL,KAAc,OAArB;AACH;AAHI,cANiB;AAW1BG,uBAAU;AACNrD,oBADM,iBACA;AACF,4BAAO,KAAKkD,IAAL,KAAc,QAArB;AACH;AAHK;AAXgB,UAA9B;;AAkBAhE,gBAAOC,IAAP;AAzB2B;AA0B9B;;;GA3BgBO,K;;mBA8BNqD,M;;;;;;;;;;;;;;;;KC9BTO,I;AACF,qBAAc;AAAA;;AACV,cAAK1H,UAAL,GAAkB,EAAlB;AACA,cAAK0F,MAAL,GAAkB,IAAlB;AACA,cAAKrD,KAAL,GAAkB,CAAC,CAAnB;AACA,cAAKC,GAAL,GAAkB,CAAC,CAAnB;AACA,cAAK8E,GAAL,GAAkB,EAAlB;AACA,cAAKhE,IAAL,GAAkB,EAAlB;AACA,cAAKrC,IAAL,GAAkB,EAAlB;;AAEAuC,gBAAOC,IAAP,CAAY,IAAZ;AACH;;;;6BAEY;AACT,oBAAO,KAAK6D,GAAL,KAAa,EAApB;AACH;;;6BAEa;AACV,oBAAO,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,GAArC,EAA0CG,OAA1C,CAAkD,KAAKH,GAAvD,CAAP;AACH;;;6BAEc;AACX,oBAAO,CAAC,KAAKO,MAAN,IAAgB,CAAC,KAAKH,OAA7B;AACH;;;;;;mBAGUE,I;;;;;;;;;;;;;;KC1BTE,K,GACF,iBAAc;AAAA;;AACV,UAAK7G,IAAL,GAAY,IAAZ;AACA,UAAKD,IAAL,GAAY,IAAZ;AACA,UAAKoB,MAAL,GAAc,IAAd;;AAEAoB,YAAOC,IAAP,CAAY,IAAZ;AACH,E;;mBAGUqE,K;;;;;;;;;;;;;;KCVTC,K,GACF,iBAA4B;AAAA,SAAhBjH,IAAgB,uEAAX,CAAC,CAAU;AAAA,SAAPC,EAAO,uEAAJ,CAAC,CAAG;;AAAA;;AACxB,UAAKD,IAAL,GAAcA,IAAd;AACA,UAAKC,EAAL,GAAcA,EAAd;;AAEAyC,YAAOC,IAAP,CAAY,IAAZ;AACH,E;;mBAGUsE,K;;;;;;;;;;;;;;;;KCTTC,K;AACF,sBAAc;AAAA;;AACV,cAAK1E,IAAL,GAAY,EAAZ;AACA,cAAK3D,OAAL,GAAe,EAAf;AACA,cAAKU,SAAL,GAAiB,EAAjB;;AAEAmD,gBAAOC,IAAP,CAAY,IAAZ;AACH;;;;6BAEY;AACT,oBAAO,KAAKH,IAAL,CAAU1D,MAAjB;AACH;;;;;;mBAGUoI,K;;;;;;;;;;;;;;ACdf;;;;;;;;KAEMC,Y;;;;;;;oCACShJ,I,EAAMR,c,EAAgB;AAC7B,kBAAKyJ,SAAL,GAAiB,KAAKA,SAAL,CAAeC,IAAf,CAAoB,IAApB,EAA0B1J,cAA1B,CAAjB;;AAEAQ,kBAAKmJ,gBAAL,CAAsB,UAAtB,EAAkC,KAAKF,SAAvC;AACAjJ,kBAAKmJ,gBAAL,CAAsB,SAAtB,EAAiC,KAAKF,SAAtC;AACAjJ,kBAAKmJ,gBAAL,CAAsB,OAAtB,EAA+B,KAAKF,SAApC;AACH;;;sCAEYjJ,I,EAAM;AACfA,kBAAKoJ,mBAAL,CAAyB,UAAzB,EAAqC,KAAKH,SAA1C;AACAjJ,kBAAKoJ,mBAAL,CAAyB,SAAzB,EAAoC,KAAKH,SAAzC;AACAjJ,kBAAKoJ,mBAAL,CAAyB,OAAzB,EAAkC,KAAKH,SAAvC;AACH;;;mCAESzJ,c,EAAgB6J,C,EAAG;AACzB,iBAAMC,YAAYD,EAAEd,IAApB;AACA,iBAAM9G,KAAK,KAAK,WAAW,eAAK8H,UAAL,CAAgBD,SAAhB,CAAhB,CAAX;;AAEA,iBAAI,OAAO7H,EAAP,KAAc,UAAlB,EAA8B;AAC1B,uBAAM,IAAIC,KAAJ,iDAAwD4H,SAAxD,OAAN;AACH;;AAED7H,gBAAG4H,CAAH,EAAM7J,cAAN;AACH;;;qCAEW6J,C,EAAG7J,c,EAAgB;AAC3BA,4BAAegK,iBAAf;AACH;;;wCAEcH,C,EAAG7J,c,EAAgB;AAC9B6J,eAAEI,cAAF;;AAEAjK,4BAAekK,cAAf,CAA8B,QAA9B,EAAwCL,EAAEnE,GAA1C;AACH;;;uCAEamE,C,EAAG7J,c,EAAgB;AAC7B,iBAAM0F,MAAMmE,EAAEnE,GAAF,CAAM2C,WAAN,EAAZ;;AAEA,iBAAI3G,UAAU,EAAd;;AAEA,iBAAImI,EAAEM,OAAN,EAAe;AACX,yBAAQzE,GAAR;AACI,0BAAK,GAAL;AACI,gCAAO1F,eAAegK,iBAAf,EAAP;AACJ,0BAAK,GAAL;AACItI,mCAAU,MAAV;;AAEA;AACJ,0BAAK,GAAL;AACIA,mCAAU,OAAV;;AAEA;AACJ,0BAAK,GAAL;AACIA,mCAAU,MAAV;;AAEA;AACJ,0BAAK,GAAL;AACIA,mCAAUmI,EAAEO,QAAF,GAAa,MAAb,GAAsB,MAAhC;;AAEA;AAlBR;AAoBH;;AAED,qBAAQ1E,GAAR;AACI,sBAAK,OAAL;AACIhE,+BAAUmI,EAAEO,QAAF,GAAa,aAAb,GAA6B,QAAvC;;AAEA;AACJ,sBAAK,WAAL;AACI1I,+BAAU,WAAV;;AAEA;AACJ,sBAAK,QAAL;AACIA,+BAAU,QAAV;;AAEA;AACJ,sBAAK,SAAL;AACI,yBAAImI,EAAEM,OAAN,EAAe;AACXzI,mCAAUmI,EAAEO,QAAF,GAAa,cAAb,GAA8B,QAAxC;AACH,sBAFD,MAEO;AACH;AACA1I,mCAAU,EAAV;AACH;;AAED;AACJ,sBAAK,WAAL;AACI,yBAAImI,EAAEM,OAAN,EAAe;AACXzI,mCAAUmI,EAAEO,QAAF,GAAa,gBAAb,GAAgC,UAA1C;AACH,sBAFD,MAEO;AACH;AACA1I,mCAAU,EAAV;AACH;;AAED;AACJ,sBAAK,WAAL;AACI,yBAAImI,EAAEM,OAAN,EAAe;AACXzI,mCAAUmI,EAAEO,QAAF,GAAa,YAAb,GAA4B,MAAtC;AACH,sBAFD,MAEO;AACH1I,mCAAUmI,EAAEO,QAAF,GAAa,YAAb,GAA4BP,EAAEQ,MAAF,GAAW,UAAX,GAAwB,MAA9D,CADG,CACmE;AACzE;;AAEDxJ,6BAAQC,GAAR,CAAYY,OAAZ,EAAqBmI,CAArB;;AAEA;AACJ,sBAAK,YAAL;AACI,yBAAIA,EAAEM,OAAN,EAAe;AACXzI,mCAAUmI,EAAEO,QAAF,GAAa,WAAb,GAA2B,KAArC;AACH,sBAFD,MAEO;AACH1I,mCAAUmI,EAAEO,QAAF,GAAa,aAAb,GAA6BP,EAAEQ,MAAF,GAAW,WAAX,GAAyB,OAAhE,CADG,CACsE;AAC5E;;AAED;AAhDR;;AAmDA,iBAAI,CAAC3I,OAAL,EAAc;;AAEdmI,eAAEI,cAAF;;AAEAjK,4BAAekK,cAAf,CAA8BxI,OAA9B;AACH;;;;;;mBAGU8H,Y;;;;;;;;;;;;;;;;AC7Hf;;;;AACA;;;;AACA;;;;;;;;KAEMc,M;;;;;;;8BACUhK,K,EAAOyB,K,EAAO;AACtB,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;AACA,iBAAMiK,UAAUxI,MAAMM,IAAN,KAAeN,MAAMO,EAArC;;AAEA,iBAAI,CAACiI,OAAD,IAAYxI,MAAMM,IAAN,KAAe,CAA/B,EAAkC,OAAO/B,KAAP;;AAElC6B,sBAASP,SAAT,GAAqB2I,UAAU,CAACxI,MAAMM,IAAP,EAAaN,MAAMM,IAAnB,CAAV,GAAqC,CAACN,MAAMM,IAAN,GAAa,CAAd,EAAiBN,MAAMM,IAAN,GAAa,CAA9B,CAA1D;;AAEA,oBAAOF,QAAP;AACH;;;oCAEiB7B,K,EAAOyB,K,EAAO;AAC5B,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIyB,MAAMM,IAAN,KAAe,CAAnB,EAAsB,OAAO/B,KAAP;;AAEtB6B,sBAASP,SAAT,GAAqB,CAACG,MAAMM,IAAN,GAAa,CAAd,EAAiBN,MAAMO,EAAvB,CAArB;;AAEA,oBAAOH,QAAP;AACH;;;+BAEY7B,K,EAAOyB,K,EAAO;AACvB,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;AACA,iBAAMiK,UAAUxI,MAAMM,IAAN,KAAeN,MAAMO,EAArC;;AAEA,iBAAI,CAACiI,OAAD,IAAYxI,MAAMO,EAAN,KAAahC,MAAMuE,IAAN,CAAW1D,MAAxC,EAAgD,OAAOb,KAAP;;AAEhD6B,sBAASP,SAAT,GAAqB2I,UAAU,CAACxI,MAAMO,EAAP,EAAWP,MAAMO,EAAjB,CAAV,GAAiC,CAACP,MAAMO,EAAN,GAAW,CAAZ,EAAeP,MAAMO,EAAN,GAAW,CAA1B,CAAtD;;AAEA,oBAAOH,QAAP;AACH;;;qCAEkB7B,K,EAAOyB,K,EAAO;AAC7B,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIyB,MAAMO,EAAN,KAAahC,MAAMuE,IAAN,CAAW1D,MAA5B,EAAoC,OAAOb,KAAP;;AAEpC6B,sBAASP,SAAT,GAAqB,CAACG,MAAMM,IAAP,EAAaN,MAAMO,EAAN,GAAW,CAAxB,CAArB;;AAEA,oBAAOH,QAAP;AACH;;;8BAEW7B,K,EAAOyB,K,EAAO;AACtB,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIgB,SAAS,IAAb;;AAEA,kBAAK,IAAIsB,IAAI,CAAb,EAAiBtB,SAAShB,MAAMY,OAAN,CAAc0B,CAAd,CAA1B,EAA6CA,GAA7C,EAAkD;AAC9C,qBAAItB,OAAO,CAAP,KAAaS,MAAMM,IAAnB,IAA2Bf,OAAO,CAAP,KAAaS,MAAMM,IAAlD,EAAwD;AACpD;AACH;AACJ;;AAEDF,sBAASP,SAAT,GAAqB,CAACN,OAAO,CAAP,CAAD,EAAYA,OAAO,CAAP,CAAZ,CAArB;;AAEA,oBAAOa,QAAP;AACH;;;oCAEiB7B,K,EAAOyB,K,EAAO;AAC5B,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIgB,SAAS,IAAb;;AAEA,kBAAK,IAAIsB,IAAI,CAAb,EAAiBtB,SAAShB,MAAMY,OAAN,CAAc0B,CAAd,CAA1B,EAA6CA,GAA7C,EAAkD;AAC9C,qBAAItB,OAAO,CAAP,KAAaS,MAAMM,IAAnB,IAA2Bf,OAAO,CAAP,KAAaS,MAAMM,IAAlD,EAAwD;AACpD;AACH;AACJ;;AAEDF,sBAASP,SAAT,GAAqB,CAACN,OAAO,CAAP,CAAD,EAAYS,MAAMM,IAAlB,CAArB;;AAEA,oBAAOF,QAAP;AACH;;;6BAEU7B,K,EAAOyB,K,EAAO;AACrB,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIgB,SAAS,IAAb;;AAEA,kBAAK,IAAIsB,IAAI,CAAb,EAAiBtB,SAAShB,MAAMY,OAAN,CAAc0B,CAAd,CAA1B,EAA6CA,GAA7C,EAAkD;AAC9C,qBAAItB,OAAO,CAAP,KAAaS,MAAMO,EAAnB,IAAyBhB,OAAO,CAAP,KAAaS,MAAMO,EAAhD,EAAoD;AAChD;AACH;AACJ;;AAEDH,sBAASP,SAAT,GAAqB,CAACN,OAAO,CAAP,CAAD,EAAYA,OAAO,CAAP,CAAZ,CAArB;;AAEA,oBAAOa,QAAP;AACH;;;mCAEgB7B,K,EAAOyB,K,EAAO;AAC3B,iBAAMI,WAAW,eAAKlB,MAAL,CAAY,qBAAZ,EAAyBX,KAAzB,CAAjB;;AAEA,iBAAIgB,SAAS,IAAb;;AAEA,kBAAK,IAAIsB,IAAI,CAAb,EAAiBtB,SAAShB,MAAMY,OAAN,CAAc0B,CAAd,CAA1B,EAA6CA,GAA7C,EAAkD;AAC9C,qBAAItB,OAAO,CAAP,KAAaS,MAAMO,EAAnB,IAAyBhB,OAAO,CAAP,KAAaS,MAAMO,EAAhD,EAAoD;AAChD;AACH;AACJ;;AAEDH,sBAASP,SAAT,GAAqB,CAACG,MAAMM,IAAP,EAAaf,OAAO,CAAP,CAAb,CAArB;;AAEA,oBAAOa,QAAP;AACH;;;gCAEa7B,K,EAAOyB,K,EAAOyI,U,EAAY;AACpC,iBAAMrI,WAAW,qBAAjB;AACA,iBAAMsI,eAAe1I,MAAMO,EAAN,GAAWP,MAAMM,IAAtC;;AAEA,iBAAIqI,aAAaF,WAAWrJ,MAA5B;AACA,iBAAIwJ,aAAaD,aAAaD,YAA9B;AACA,iBAAIG,YAAY,EAAhB;AACA,iBAAIC,iBAAiB,CAArB;;AAEA1I,sBAAS0C,IAAT,GAAgBvE,MAAMuE,IAAN,CAAW8D,KAAX,CAAiB,CAAjB,EAAoB5G,MAAMM,IAA1B,IAAkCmI,UAAlC,GAA+ClK,MAAMuE,IAAN,CAAW8D,KAAX,CAAiB5G,MAAMO,EAAvB,CAA/D;;AAEAsI,yBAAYN,OAAOQ,kBAAP,CAA0B3I,SAAS0C,IAAnC,CAAZ;;AAEA,iBAAI,CAACgG,iBAAiB1I,SAAS0C,IAAT,CAAc1D,MAAd,GAAuByJ,UAAUzJ,MAAnD,IAA6D,CAAjE,EAAoE;AAChEuJ,+BAAcG,cAAd;AACAF,+BAAcE,cAAd;;AAEA1I,0BAAS0C,IAAT,GAAgB+F,SAAhB;AACH;;AAEDzI,sBAASjB,OAAT,GAAmBoJ,OAAOS,aAAP,CAAqBzK,MAAMY,OAA3B,EAAoCa,MAAMM,IAA1C,EAAgDN,MAAMO,EAAtD,EAA0DoI,UAA1D,EAAsEC,UAAtE,EAAkFxI,SAAS0C,IAA3F,CAAnB;;AAEA1C,sBAASP,SAAT,GAAqB,CAACG,MAAMM,IAAN,GAAaqI,UAAd,EAA0B3I,MAAMM,IAAN,GAAaqI,UAAvC,CAArB;;AAEA,oBAAOvI,QAAP;AACH;;;4CAEyB0C,I,EAAM;AAC5B;;AAEA,iBAAI+F,YAAY/F,KAAKyD,OAAL,CAAa,QAAb,EAAuB,GAAvB,CAAhB;;AAEA;;AAEAsC,yBAAY/F,KAAKyD,OAAL,CAAa,OAAb,EAAsB,KAAtB,CAAZ;;AAEA;;AAEAsC,yBAAY/F,KAAKyD,OAAL,CAAa,OAAb,EAAsB,IAAtB,CAAZ;;AAEA,oBAAOsC,SAAP;AACH;;;mCAEgBtK,K,EAAOyB,K,EAAO;AAC3B,iBAAMI,WAAW,qBAAjB;AACA,iBAAMoI,UAAUxI,MAAMM,IAAN,KAAeN,MAAMO,EAArC;AACA,iBAAM0I,YAAYT,UAAUxI,MAAMM,IAAhB,GAAuBN,MAAMO,EAAN,GAAW,CAApD;;AAEA,iBAAIqI,aAAaK,YAAYjJ,MAAMO,EAAnC;AACA,iBAAIuI,iBAAiB,CAAC,CAAtB;AACA,iBAAID,YAAY,EAAhB;;AAEA,iBAAI7I,MAAMO,EAAN,KAAa,CAAjB,EAAoB,OAAOhC,KAAP;;AAEpB6B,sBAAS0C,IAAT,GAAgBvE,MAAMuE,IAAN,CAAW8D,KAAX,CAAiB,CAAjB,EAAoBqC,SAApB,IAAiC1K,MAAMuE,IAAN,CAAW8D,KAAX,CAAiB5G,MAAMO,EAAvB,CAAjD;;AAEAsI,yBAAYN,OAAOQ,kBAAP,CAA0B3I,SAAS0C,IAAnC,CAAZ;;AAEA,iBAAI,CAACgG,iBAAiB1I,SAAS0C,IAAT,CAAc1D,MAAd,GAAuByJ,UAAUzJ,MAAnD,IAA6D,CAAjE,EAAoE;AAChEwJ,+BAAcE,cAAd;;AAEA1I,0BAAS0C,IAAT,GAAgB+F,SAAhB;AACH;;AAEDzI,sBAASjB,OAAT,GAAmBoJ,OAAOS,aAAP,CAAqBzK,MAAMY,OAA3B,EAAoC8J,SAApC,EAA+CjJ,MAAMO,EAArD,EAAyD,CAAzD,EAA4DqI,UAA5D,EAAwExI,SAAS0C,IAAjF,CAAnB;;AAEA1C,sBAASP,SAAT,GAAqB,CAACoJ,SAAD,EAAYA,SAAZ,CAArB;;AAEA,oBAAO7I,QAAP;AACH;;;iCAEa7B,K,EAAOyB,K,EAAO;AACxB,iBAAMI,WAAW,qBAAjB;AACA,iBAAMoI,UAAUxI,MAAMM,IAAN,KAAeN,MAAMO,EAArC;AACA,iBAAM2I,UAAUV,UAAUxI,MAAMO,EAAhB,GAAqBP,MAAMM,IAAN,GAAa,CAAlD;;AAEA,iBAAIsI,aAAa5I,MAAMM,IAAN,GAAa4I,OAA9B;AACA,iBAAIJ,iBAAiB,CAAC,CAAtB;AACA,iBAAID,YAAY,EAAhB;;AAEA,iBAAI7I,MAAMM,IAAN,KAAe/B,MAAMuE,IAAN,CAAW1D,MAA9B,EAAsC,OAAOb,KAAP;;AAEtC6B,sBAAS0C,IAAT,GAAgBvE,MAAMuE,IAAN,CAAW8D,KAAX,CAAiB,CAAjB,EAAoB5G,MAAMM,IAA1B,IAAkC/B,MAAMuE,IAAN,CAAW8D,KAAX,CAAiBsC,OAAjB,CAAlD;;AAEAL,yBAAYN,OAAOQ,kBAAP,CAA0B3I,SAAS0C,IAAnC,CAAZ;;AAEA,iBAAI,CAACgG,iBAAiB1I,SAAS0C,IAAT,CAAc1D,MAAd,GAAuByJ,UAAUzJ,MAAnD,IAA6D,CAAjE,EAAoE;AAChEwJ,+BAAcE,cAAd;;AAEA1I,0BAAS0C,IAAT,GAAgB+F,SAAhB;AACH;;AAEDzI,sBAASjB,OAAT,GAAmBoJ,OAAOS,aAAP,CAAqBzK,MAAMY,OAA3B,EAAoCa,MAAMM,IAA1C,EAAgD4I,OAAhD,EAAyD,CAAzD,EAA4DN,UAA5D,EAAwExI,SAAS0C,IAAjF,CAAnB;;AAEA1C,sBAASP,SAAT,GAAqB,CAACG,MAAMM,IAAP,EAAaN,MAAMM,IAAnB,CAArB;;AAEA,oBAAOF,QAAP;AACH;;;uCAEoBjB,O,EAAS8J,S,EAAWC,O,EAASP,U,EAAYC,U,EAAY;AACtE,iBAAMO,aAAa,EAAnB;;AAEA,kBAAK,IAAItI,IAAI,CAAR,EAAWtB,MAAhB,EAAyBA,SAASJ,QAAQ0B,CAAR,CAAlC,EAA+CA,GAA/C,EAAoD;AAAA,+BACtBtB,MADsB;AAAA;AAAA,qBACzCuH,GADyC;AAAA,qBACpC/E,KADoC;AAAA,qBAC7BC,GAD6B;;AAEhD,qBAAMoH,YAAY,qBAAW7J,MAAX,CAAlB;;AAEA,qBAAI8J,eAAe,KAAnB;;AAEA,qBAAI,EAAE9J,kCAAF,CAAJ,EAAiC;AAC7BA,8BAAS,qBAAWA,MAAX,CAAT;AACH;;AAED,qBAAIwC,SAASkH,SAAT,IAAsBjH,OAAOkH,OAAjC,EAA0C;AACtC;;AAEA,yBAAInH,UAAUkH,SAAV,KAAwB1J,OAAO2H,OAAP,IAAkB3H,OAAO4H,QAAP,IAAmBwB,aAAa,CAA1E,CAAJ,EAAkF;AAC9E;AACA;AACAS,mCAAU,CAAV,IAAerH,QAAQ4G,UAAvB;AACH,sBAJD,MAIO,IAAI,CAACpJ,OAAO2H,OAAZ,EAAqB;AACxBmC,wCAAe,IAAf;AACH;AACJ,kBAVD,MAUO,IAAItH,SAASkH,SAAT,IAAsBjH,OAAOkH,OAAjC,EAA0C;AAC7C;;AAEAE,+BAAU,CAAV,KAAgBR,UAAhB;;AAEA,yBAAIrJ,OAAO4H,QAAP,IAAoBpF,UAAUkH,SAAV,IAAuBA,cAAcC,OAA7D,EAAuE;AACnE;;AAEAE,mCAAU,CAAV,KAAgBR,UAAhB;AACH;AACJ,kBAVM,MAUA,IAAI7G,SAASmH,OAAb,EAAsB;AACzB;;AAEAE,+BAAU,CAAV,KAAgBR,UAAhB;AACAQ,+BAAU,CAAV,KAAgBR,UAAhB;AACH,kBALM,MAKA,IAAIK,YAAYlH,KAAZ,IAAqBmH,UAAUnH,KAA/B,IAAwCmH,UAAUlH,GAAtD,EAA2D;AAC9D;;AAEA,yBAAIzC,OAAO4H,QAAX,EAAqB;AACjBiC,mCAAU,CAAV,KAAiBR,cAAcM,UAAUnH,KAAxB,CAAjB;AACAqH,mCAAU,CAAV,KAAgBR,UAAhB;AACH,sBAHD,MAGO;AACH;;AAEAS,wCAAe,IAAf;AACH;AACJ,kBAXM,MAWA,IAAIJ,YAAYlH,KAAZ,IAAqBkH,YAAYjH,GAAjC,IAAwCkH,UAAUlH,GAAtD,EAA2D;AAC9D;;AAEA,yBAAIzC,OAAO4H,QAAX,EAAqB;AACjB;;AAEAiC,mCAAU,CAAV,IAAeH,YAAYN,UAA3B;AACH,sBAJD,MAIO;AACH,6BAAMW,kBAAkBf,OAAOgB,kBAAP,CAA0BpK,OAA1B,EAAmC0B,CAAnC,CAAxB;;AAEA;;AAEAuI,mCAAU,CAAV,IAAeE,gBAAgB,CAAhB,IAAqBV,UAApC;AACH;AACJ;;AAED,qBAAI,CAACS,YAAL,EAAmB;AACfF,gCAAW9J,IAAX,CAAgB+J,SAAhB;AACH;AACJ;;AAED,oBAAOD,UAAP;AACH;;;4CAEyBhK,O,EAASwB,K,EAAO;AACtC,kBAAK,IAAIE,IAAIF,QAAQ,CAAhB,EAAmBpB,MAAxB,EAAiCA,SAASJ,QAAQ0B,CAAR,CAA1C,EAAuDA,GAAvD,EAA4D;AACxD,qBAAI,EAAEtB,kCAAF,CAAJ,EAAiC;AAC7BA,8BAAS,qBAAWA,MAAX,CAAT;AACH;;AAED,qBAAIA,OAAO2H,OAAX,EAAoB;AAChB,4BAAO3H,MAAP;AACH;AACJ;;AAED,oBAAO,IAAP;AACH;;;;;;mBAGUgJ,M;;;;;;;;;;;;;;AC1Sf;;;;;;;;KAEMiB,W;;;;;;;;AACF;;;;;;;2CAOyB/K,I,EAAMqE,I,EAAM3D,O,EAAS;AAC1C,iBAAMsK,YAAY,EAAlB;;AAEA,iBAAIC,WAAW,KAAf;AACA,iBAAIlJ,OAAO/B,IAAX;;AAEA+B,kBAAKuB,KAAL,GAAa,CAAb;AACAvB,kBAAKwB,GAAL,GAAWc,KAAK1D,MAAhB;;AAEA,kBAAK,IAAIyB,IAAI,CAAb,EAAgBA,KAAKiC,KAAK1D,MAA1B,EAAkCyB,GAAlC,EAAuC;AACnC,qBAAI8I,kBAAkB,KAAtB;;AAEA,sBAAK,IAAIC,IAAI,CAAR,EAAWrK,MAAhB,EAAyBA,SAASJ,QAAQyK,CAAR,CAAlC,EAA+CA,GAA/C,EAAoD;AAChD,yBAAIC,aAAa,IAAjB;;AAEA,yBAAItK,OAAO,CAAP,MAAcsB,CAAd,IAAmBtB,OAAO,CAAP,MAAcA,OAAO,CAAP,CAArC,EAAgD;;AAEhD,yBAAImK,YAAYD,UAAUA,UAAUrK,MAAV,GAAmB,CAA7B,EAAgCiI,MAAhD,EAAwD;AACpD,6BAAMyC,WAAWL,UAAU3D,GAAV,EAAjB;;AAEA0D,qCAAYO,SAAZ,CAAsBD,QAAtB,EAAgCjJ,CAAhC,EAAmCiC,IAAnC;;AAEA4G,oCAAW,KAAX;AACH;;AAEDC,uCAAkB,IAAlB;;AAEAE,kCAAaJ,UAAU3D,GAAV,EAAb;;AAEA0D,iCAAYO,SAAZ,CAAsBF,UAAtB,EAAkChJ,CAAlC;;AAEAL,4BAAOqJ,WAAWzE,MAAlB;AACH;;AAED,sBAAK,IAAIwE,KAAI,CAAR,EAAWrK,OAAhB,EAAyBA,UAASJ,QAAQyK,EAAR,CAAlC,EAA+CA,IAA/C,EAAoD;AAChD,yBAAII,UAAU,IAAd;;AAEA,yBAAIzK,QAAO,CAAP,MAAcsB,CAAlB,EAAqB;;AAErB,yBAAI6I,QAAJ,EAAc;AACV,6BAAMI,YAAWL,UAAU3D,GAAV,EAAjB;;AAEA0D,qCAAYO,SAAZ,CAAsBD,SAAtB,EAAgCjJ,CAAhC,EAAmCiC,IAAnC;;AAEA4G,oCAAW,KAAX;AACH;;AAEDM,+BAAUR,YAAYS,WAAZ,CAAwB1K,QAAO,CAAP,CAAxB,EAAmCsB,CAAnC,EAAsCL,IAAtC,CAAV;;AAEAiJ,+BAAUpK,IAAV,CAAe2K,OAAf;;AAEAxJ,0BAAKd,UAAL,CAAgBL,IAAhB,CAAqB2K,OAArB;;AAEAxJ,4BAAOwJ,OAAP;;AAEAL,uCAAkB,IAAlB;;AAEA,yBAAIpK,QAAO,CAAP,MAAcA,QAAO,CAAP,CAAlB,EAA6B;AACzB;;AAEAiK,qCAAYO,SAAZ,CAAsBvJ,IAAtB,EAA4BK,CAA5B;AACH;AACJ;;AAED,qBAAI8I,eAAJ,EAAqB;AACjB,yBAAMO,OAAOV,YAAYS,WAAZ,CAAwB,EAAxB,EAA4BpJ,CAA5B,EAA+BL,IAA/B,CAAb;;AAEA,yBAAIA,KAAKuB,KAAL,KAAevB,KAAKwB,GAAxB,EAA6B;AACzB;;AAEAxB,8BAAKd,UAAL,CAAgBL,IAAhB,CAAqB6K,IAArB;;AAEAV,qCAAYO,SAAZ,CAAsBG,IAAtB,EAA4BrJ,CAA5B;;AAEAL,gCAAOA,KAAK4E,MAAZ;;AAEAqE,mCAAU3D,GAAV;AACH,sBAVD,MAUO,IAAIjF,IAAIiC,KAAK1D,MAAb,EAAqB;AACxB;;AAEAoB,8BAAKd,UAAL,CAAgBL,IAAhB,CAAqB6K,IAArB;;AAEAT,mCAAUpK,IAAV,CAAe6K,IAAf;;AAEAR,oCAAW,IAAX;AACH;;AAEDC,uCAAkB,KAAlB;AACH;AACJ;AACJ;;AAED;;;;;;;;;qCAOmB7C,G,EAAK/E,K,EAAOqD,M,EAAQ;AACnC,iBAAM5E,OAAO,oBAAb;;AAEAA,kBAAKsG,GAAL,GAAcA,GAAd;AACAtG,kBAAK4E,MAAL,GAAcA,MAAd;AACA5E,kBAAKuB,KAAL,GAAcA,KAAd;AACAvB,kBAAKC,IAAL,GAAc2E,OAAO3E,IAAP,CAAYmG,KAAZ,EAAd;;AAEApG,kBAAKC,IAAL,CAAUpB,IAAV,CAAe+F,OAAO1F,UAAP,CAAkBN,MAAjC;;AAEA,oBAAOoB,IAAP;AACH;;AAED;;;;;;;;;mCAOiBA,I,EAAMwB,G,EAAc;AAAA,iBAATc,IAAS,uEAAJ,EAAI;;AACjCtC,kBAAKwB,GAAL,GAAWA,GAAX;;AAEA,iBAAIxB,KAAK6G,MAAT,EAAiB;AACb7G,sBAAKsC,IAAL,GAAYA,KAAK8D,KAAL,CAAWpG,KAAKuB,KAAhB,EAAuBvB,KAAKwB,GAA5B,CAAZ;AACH;AACJ;;;;;;mBAGUwH,W;;;;;;;;;;;;;;;;KC1ITW,Q;;;;;;;qCACiBC,K,EAAoB;AAAA,iBAAbhF,MAAa,uEAAN,IAAM;;AACnC,oBAAOgF,MAAM9K,GAAN,CAAU;AAAA,wBAAQ6K,SAASE,UAAT,CAAoB7J,IAApB,EAA0B4E,MAA1B,CAAR;AAAA,cAAV,EAAqDY,IAArD,CAA0D,EAA1D,CAAP;AACH;;;oCAEiBxF,I,EAAM4E,M,EAAQ;AAC5B,iBAAIkF,OAAO,EAAX;;AAEA,iBAAI9J,KAAKsG,GAAT,EAAc;AACVwD,yBAAQ,MAAM9J,KAAKsG,GAAX,GAAiB,GAAzB;AACH;;AAED,iBAAItG,KAAKd,UAAL,CAAgBN,MAApB,EAA4B;AACxBkL,yBAAQH,SAAS1K,WAAT,CAAqBe,KAAKd,UAA1B,EAAsCc,IAAtC,CAAR;AACH,cAFD,MAEO;AACH;;AAEA8J,yBAAQ9J,KAAKsC,IAAL,CAAU1D,MAAV,GAAmBoB,KAAKsC,IAAxB,GAA+B,SAAvC;AACH;;AAED,iBAAIsC,UAAUA,OAAO1F,UAAP,CAAkB0F,OAAO1F,UAAP,CAAkBN,MAAlB,GAA2B,CAA7C,MAAoDoB,IAA9D,IAAsE8J,KAAKC,KAAL,CAAW,IAAX,CAA1E,EAA4F;AACxFD,yBAAQ,SAAR;AACH;;AAED,iBAAI9J,KAAKsG,GAAT,EAAc;AACVwD,yBAAQ,OAAO9J,KAAKsG,GAAZ,GAAkB,GAA1B;AACH;;AAED,oBAAOwD,IAAP;AACH;;;;;;mBAGUH,Q;;;;;;AChCf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"rte.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rte\"] = factory();\n\telse\n\t\troot[\"rte\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7aa03ab331dea726ef1e","import RichTextEditor from './RichTextEditor';\nimport data           from '../tests/data.json';\n\nfunction factory(el) {\n    const richTextEditor = new RichTextEditor();\n\n    richTextEditor.attach(el);\n\n    return richTextEditor;\n}\n\nmodule.exports = factory;\n\n\n// WEBPACK FOOTER //\n// ./src/factory.js","import Dom          from './Dom';\nimport Util         from './Util';\nimport Markup       from './models/Markup';\nimport Node         from './models/Node';\nimport Caret        from './models/Caret';\nimport Range        from './models/Range';\nimport State        from './models/State';\nimport EventHandler from './EventHandler';\nimport Editor       from './Editor';\nimport TreeBuilder  from './TreeBuilder';\nimport Renderer     from './Renderer';\n\nclass RichTextEditor {\n    constructor() {\n        this.dom            = new Dom();\n        this.state          = new State();\n        this.eventHandler   = new EventHandler();\n        this.root           = null;\n        this.history        = [];\n    }\n\n    attach(el, initialState=new State()) {\n        this.dom.root = el;\n\n        this.buildInitialState(initialState);\n\n        this.root = RichTextEditor.buildModelFromState(this.state);\n\n        console.log(this.root);\n\n        this.render();\n\n        this.eventHandler.bindEvents(this.dom.root, this);\n    }\n\n    /**\n     * @param   {object} initialState\n     * @return  {void}\n     */\n\n    buildInitialState(initialState) {\n        Util.extend(this.state, initialState);\n\n        if (this.state.markups.length < 1) {\n            this.state.markups.push(['p', 0, 0]);\n        }\n\n        this.state.markups = this.state.markups.map(markup => new Markup(markup));\n    }\n\n    render() {\n        this.dom.root.innerHTML = Renderer.renderNodes(this.root.childNodes);\n    }\n\n    performCommand(command, content) {\n        const selection = window.getSelection();\n        const range = this.getRangeFromSelection(selection);\n\n        const fn = Editor[command];\n\n        if (typeof fn !== 'function') {\n            throw new Error(`[RichTextEditor] No editor method for command \"${command}\"`);\n        }\n\n        const newState = fn(this.state, range, content);\n\n        if (newState === this.state) return;\n\n        this.history.push(this.state);\n\n        this.state = newState;\n\n        this.root = RichTextEditor.buildModelFromState(this.state);\n\n        this.render();\n\n        this.positionCaret(this.state.selection);\n    }\n\n    sanitizeSelection() {\n        const selection = window.getSelection();\n        const range = this.getRangeFromSelection(selection);\n\n        console.log(range);\n\n        this.positionCaret([range.from, range.to]);\n    }\n\n    getPathFromNode(node) {\n        const path = [];\n\n        while (node && node !== this.dom.root) {\n            path.unshift(Util.index(node, true));\n\n            node = node.parentElement;\n        }\n\n        return path;\n    }\n\n    getNodeByPath(path, root) {\n        let node = root;\n        let index = -1;\n        let i = 0;\n\n        while (typeof (index = path[i]) === 'number') {\n            node = node.childNodes[index];\n\n            i++;\n        }\n\n        return node || null;\n    }\n\n    /**\n     * @param   {Selection} selection\n     * @return  {Range}\n     */\n\n    getRangeFromSelection(selection) {\n        const anchorPath = this.getPathFromNode(selection.anchorNode);\n        const virtualAnchorNode = this.getNodeByPath(anchorPath, this.root);\n        const from = new Caret();\n        const to = new Caret();\n\n        let extentPath = anchorPath;\n        let virtualExtentNode = virtualAnchorNode;\n        let isRtl = false;\n        let rangeFrom = -1;\n        let rangeTo = -1;\n\n        if (!selection.isCollapsed) {\n            extentPath = this.getPathFromNode(selection.extentNode);\n            virtualExtentNode = this.getNodeByPath(extentPath, this.root);\n        }\n\n        isRtl = extentPath < anchorPath || !(extentPath > anchorPath) && selection.anchorOffset > selection.extentOffset;\n\n        from.node   = to.node = isRtl ? virtualExtentNode : virtualAnchorNode;\n        from.offset = to.offset = isRtl ? selection.extentOffset : selection.anchorOffset;\n        from.path   = to.path = isRtl ? extentPath : anchorPath;\n\n        if (!selection.isCollapsed) {\n            to.node     = isRtl ? virtualAnchorNode : virtualExtentNode;\n            to.offset   = isRtl ? selection.anchorOffset : selection.extentOffset;\n            to.path     = isRtl ? anchorPath : extentPath;\n        }\n\n        rangeFrom = Math.min(from.node.start + from.offset, from.node.end);\n        rangeTo = Math.min(to.node.start + to.offset, to.node.end);\n\n        return new Range(rangeFrom, rangeTo);\n    }\n\n    positionCaret([start, end]) {\n        const range = document.createRange();\n        const selection = window.getSelection();\n\n        let childNodes  = this.root.childNodes;\n        let virtualNode = null;\n        let nodeLeft    = null;\n        let nodeRight   = null;\n        let offsetStart = -1;\n        let offsetEnd   = -1;\n\n        for (let i = 0; (virtualNode = childNodes[i]); i++) {\n            // Node ends before caret\n\n            if (virtualNode.end < start) continue;\n\n            // The desired node is this node, or within this node\n\n            if (virtualNode.childNodes.length) {\n                // Node has children, drop down until at leaf\n\n                childNodes = virtualNode.childNodes;\n\n                i = -1;\n\n                continue;\n            }\n\n            // At leaf\n\n            offsetStart = start - virtualNode.start;\n\n            break;\n        }\n\n        nodeLeft = this.getNodeByPath(virtualNode.path, this.dom.root);\n\n        range.setStart(nodeLeft, offsetStart);\n\n        if (start === end) {\n            // Single caret\n\n            range.collapse(true);\n        } else {\n            // Multi-character selection, reset child nodes\n\n            childNodes = this.root.childNodes;\n\n            for (let i = 0; (virtualNode = childNodes[i]); i++) {\n                if (virtualNode.end < end) continue;\n\n                if (virtualNode.childNodes.length) {\n                    childNodes = virtualNode.childNodes;\n\n                    i = -1;\n\n                    continue;\n                }\n\n                offsetEnd = end - virtualNode.start;\n\n                break;\n            }\n\n            nodeRight = this.getNodeByPath(virtualNode.path, this.dom.root);\n\n            range.setEnd(nodeRight, offsetEnd);\n        }\n\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n\n    static buildModelFromState(state) {\n        const root = new Node();\n\n        TreeBuilder.buildTreeFromRoot(root, state.text, state.markups);\n\n        return root;\n    }\n}\n\nexport default RichTextEditor;\n\n\n// WEBPACK FOOTER //\n// ./src/RichTextEditor.js","class Dom {\n    constructor() {\n        this.root = null;\n\n        Object.seal(this);\n    }\n}\n\nexport default Dom;\n\n\n// WEBPACK FOOTER //\n// ./src/Dom.js","class Util {\n\n    /**\n     * @param   {object} target\n     * @param   {object} source\n     * @param   {boolean} deep\n     * @return  {object}\n     */\n\n    static extend(target, source, deep) {\n        let sourceKeys = [];\n\n        if (!target || typeof target !== 'object') {\n            throw new TypeError('[Util#extend] Target must be a valid object');\n        }\n\n        deep = deep || false;\n\n        if (Array.isArray(source)) {\n            for (let i = 0; i < source.length; i++) {\n                sourceKeys.push(i);\n            }\n        } else if (source) {\n            sourceKeys = Object.keys(source);\n        }\n\n        for (let i = 0; i < sourceKeys.length; i++) {\n            let key = sourceKeys[i];\n            let descriptor = Object.getOwnPropertyDescriptor(source, key);\n\n            // Skip computed properties\n\n            if (typeof descriptor.get === 'function') continue;\n\n            if (!deep || typeof source[key] !== 'object') {\n                // All non-object primitives, or all properties if\n                // shallow extend\n\n                target[key] = source[key];\n            } else if (Array.isArray(source[key])) {\n                // Arrays\n\n                if (!target[key]) {\n                    target[key] = [];\n                }\n\n                this.extend(target[key], source[key], deep);\n            } else {\n                // Objects\n\n                if (!target[key]) {\n                    target[key] = {};\n                }\n\n                this.extend(target[key], source[key], deep);\n            }\n        }\n\n        return target;\n    }\n\n    /**\n     * Flattens an array.\n     *\n     * @param {Array} arr\n     * @return {Array}\n     */\n\n    static flattenArray(arr) {\n        return arr.reduce((prev, curr) => {\n            if (Array.isArray(curr)) {\n                return prev.concat(curr);\n            }\n\n            prev.push(curr);\n\n            return prev;\n        }, []);\n    }\n\n    /**\n     * Returns a function which calls the provided function\n     * only after the specified interval has elapsed between\n     * function calls. An optional `immediate` boolean will\n     * cause the provided function to be called once immediately\n     * before waiting.\n     *\n     * @param   {function}  fn\n     * @param   {number}    interval\n     * @param   {boolean}   [immediate=false]\n     * @return  {function}\n     */\n\n    static debounce(fn, interval, immediate) {\n        let timeoutId = -1;\n\n        return function() {\n            const args = arguments;\n\n            const later = () => {\n                timeoutId = -1;\n\n                fn.apply(this, args); // eslint-disable-line no-invalid-this\n            };\n\n            if (timeoutId < 0 && immediate) {\n                later();\n            } else {\n                clearTimeout(timeoutId);\n\n                timeoutId = setTimeout(later, interval);\n            }\n        };\n    }\n\n    /**\n     * Returns a function which calls the provided function once per maximum\n     * specified interval.\n     *\n     * @param   {function}  fn\n     * @param   {number}    interval\n     * @return  {function}\n     */\n\n    static throttle(fn, interval) {\n        let timeoutId = -1;\n        let last = -1;\n\n        return function() {\n            const args = arguments;\n            const now = Date.now();\n            const difference = last ? now - last : Infinity;\n\n            const later = () => {\n                last = now;\n\n                fn.apply(this, args); // eslint-disable-line no-invalid-this\n            };\n\n            if (!last || difference >= interval) {\n                later();\n            } else {\n                clearTimeout(timeoutId);\n\n                timeoutId = setTimeout(later, interval - difference);\n            }\n        };\n    }\n\n    /**\n     * @param   {HTMLElement}       el\n     * @param   {string}            selector\n     * @param   {boolean}           [includeSelf]\n     * @return  {HTMLElement|null}\n     */\n\n    static closestParent(el, selector, includeSelf) {\n        let parent = el.parentNode;\n\n        if (includeSelf && el.matches(selector)) {\n            return el;\n        }\n\n        while (parent && parent !== document.body) {\n            if (parent.matches && parent.matches(selector)) {\n                return parent;\n            } else if (parent.parentNode) {\n                parent = parent.parentNode;\n            } else {\n                return null;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * @param   {Element}     el\n     * @param   {string}      selector\n     * @return  {Element[]}\n     */\n\n    static children(el, selector) {\n        const selectors = selector.split(',');\n        const childSelectors = [];\n\n        let children = null;\n        let tempId   = '';\n\n        if (!el.id) {\n            tempId = '_temp_';\n\n            el.id = tempId;\n        }\n\n        while (selectors.length) {\n            childSelectors.push('#' + el.id + '>' + selectors.pop());\n        }\n\n        children = document.querySelectorAll(childSelectors.join(', '));\n\n        if (tempId) {\n            el.removeAttribute('id');\n        }\n\n        return children;\n    }\n\n    /**\n     * @param   {Node}        node\n     * @param   {boolean}     [includeNonElements=false]\n     * @return  {Element[]}\n     */\n\n    static index(node, includeNonElements=false) {\n        let index = 0;\n\n        while ((node = includeNonElements ? node.previousSibling : node.previousElementSibling) !== null) {\n            index++;\n        }\n\n        return index;\n    }\n\n    /**\n     * Converts a dash or snake-case string to camel case.\n     *\n     * @param   {string}    str\n     * @return  {string}\n     */\n\n    static camelCase(str) {\n        return str.toLowerCase()\n            .replace(/([_-][a-z0-9])/g, $1 => $1.toUpperCase().replace(/[_-]/, ''));\n    }\n\n    /**\n     * Converts a dash or snake-case string to pascal case.\n     *\n     * @param   {string}    str\n     * @return  {string}\n     */\n\n    static pascalCase(str) {\n        return (str = Util.camelCase(str))\n            .charAt(0)\n            .toUpperCase() + str.slice(1);\n    }\n\n    /**\n     * Converts a camel or pascal-case string to dash case.\n     *\n     * @param   {string}    str\n     * @return  {string}\n     */\n\n    static dashCase(str) {\n        return str.replace(/([A-Z])/g, '-$1')\n            .replace(/^-/, '')\n            .toLowerCase();\n    }\n}\n\nexport default Util;\n\n\n// WEBPACK FOOTER //\n// ./src/Util.js","class Markup extends Array {\n    constructor([tag, start, end]) {\n        super();\n\n        this[0] = tag;\n        this[1] = start;\n        this[2] = end;\n\n        Object.defineProperties(this, {\n            type: {\n                get() {\n                    return ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].indexOf(this[0]) > -1 ? 'block' : 'inline';\n                }\n            },\n            isBlock: {\n                get() {\n                    return this.type === 'block';\n                }\n            },\n            isInline: {\n                get() {\n                    return this.type === 'inline';\n                }\n            }\n        });\n\n        Object.seal(this);\n    }\n}\n\nexport default Markup;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Markup.js","class Node {\n    constructor() {\n        this.childNodes = [];\n        this.parent     = null;\n        this.start      = -1;\n        this.end        = -1;\n        this.tag        = '';\n        this.text       = '';\n        this.path       = [];\n\n        Object.seal(this);\n    }\n\n    get isText() {\n        return this.tag === '';\n    }\n\n    get isBlock() {\n        return ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p'].indexOf(this.tag);\n    }\n\n    get isInline() {\n        return !this.isText && !this.isBlock;\n    }\n}\n\nexport default Node;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Node.js","class Caret {\n    constructor() {\n        this.path = null;\n        this.node = null;\n        this.offset = null;\n\n        Object.seal(this);\n    }\n}\n\nexport default Caret;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Caret.js","class Range {\n    constructor(from=-1, to=-1) {\n        this.from   = from;\n        this.to     = to;\n\n        Object.seal(this);\n    }\n}\n\nexport default Range;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Range.js","class State {\n    constructor() {\n        this.text = '';\n        this.markups = [];\n        this.selection = [];\n\n        Object.seal(this);\n    }\n\n    get length() {\n        return this.text.length;\n    }\n}\n\nexport default State;\n\n\n// WEBPACK FOOTER //\n// ./src/models/State.js","import Util from './Util';\n\nclass EventHandler {\n    bindEvents(root, richTextEditor) {\n        this.delegator = this.delegator.bind(this, richTextEditor);\n\n        root.addEventListener('keypress', this.delegator);\n        root.addEventListener('keydown', this.delegator);\n        root.addEventListener('click', this.delegator);\n    }\n\n    unbindEvents(root) {\n        root.removeEventListener('keypress', this.delegator);\n        root.removeEventListener('keydown', this.delegator);\n        root.removeEventListener('click', this.delegator);\n    }\n\n    delegator(richTextEditor, e) {\n        const eventType = e.type;\n        const fn = this['handle' + Util.pascalCase(eventType)];\n\n        if (typeof fn !== 'function') {\n            throw new Error(`[EventHandler] No handler found for event \"${eventType}\"`);\n        }\n\n        fn(e, richTextEditor);\n    }\n\n    handleClick(e, richTextEditor) {\n        richTextEditor.sanitizeSelection();\n    }\n\n    handleKeypress(e, richTextEditor) {\n        e.preventDefault();\n\n        richTextEditor.performCommand('insert', e.key);\n    }\n\n    handleKeydown(e, richTextEditor) {\n        const key = e.key.toLowerCase();\n\n        let command = '';\n\n        if (e.metaKey) {\n            switch (key) {\n                case 'a':\n                    return richTextEditor.sanitizeSelection();\n                case 'c':\n                    command = 'copy';\n\n                    break;\n                case 'v':\n                    command = 'paste';\n\n                    break;\n                case 's':\n                    command = 'save';\n\n                    break;\n                case 'z':\n                    command = e.shiftKey ? 'redo' : 'undo';\n\n                    break;\n            }\n        }\n\n        switch (key) {\n            case 'enter':\n                command = e.shiftKey ? 'shiftReturn' : 'return';\n\n                break;\n            case 'backspace':\n                command = 'backspace';\n\n                break;\n            case 'delete':\n                command = 'delete';\n\n                break;\n            case 'arrowup':\n                if (e.metaKey) {\n                    command = e.shiftKey ? 'pageUpSelect' : 'pageUp';\n                } else {\n                    // TODO: line up if neccessary\n                    command = '';\n                }\n\n                break;\n            case 'arrowdown':\n                if (e.metaKey) {\n                    command = e.shiftKey ? 'pageDownSelect' : 'pageDown';\n                } else {\n                    // TODO: line down if neccessary\n                    command = '';\n                }\n\n                break;\n            case 'arrowleft':\n                if (e.metaKey) {\n                    command = e.shiftKey ? 'homeSelect' : 'home';\n                } else {\n                    command = e.shiftKey ? 'leftSelect' : e.altKey ? 'leftSkip' : 'left'; // eslint-disable-line no-nested-ternary\n                }\n\n                console.log(command, e);\n\n                break;\n            case 'arrowright':\n                if (e.metaKey) {\n                    command = e.shiftKey ? 'endSelect' : 'end';\n                } else {\n                    command = e.shiftKey ? 'rightSelect' : e.altKey ? 'rightSkip' : 'right'; // eslint-disable-line no-nested-ternary\n                }\n\n                break;\n        }\n\n        if (!command) return;\n\n        e.preventDefault();\n\n        richTextEditor.performCommand(command);\n    }\n}\n\nexport default EventHandler;\n\n\n// WEBPACK FOOTER //\n// ./src/EventHandler.js","import State    from './models/State';\nimport Markup   from './models/Markup';\nimport Util     from './Util';\n\nclass Editor {\n    static left(state, range) {\n        const newState = Util.extend(new State(), state);\n        const isRange = range.from !== range.to;\n\n        if (!isRange && range.from === 0) return state;\n\n        newState.selection = isRange ? [range.from, range.from] : [range.from - 1, range.from - 1];\n\n        return newState;\n    }\n\n    static leftSelect(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        if (range.from === 0) return state;\n\n        newState.selection = [range.from - 1, range.to];\n\n        return newState;\n    }\n\n    static right(state, range) {\n        const newState = Util.extend(new State(), state);\n        const isRange = range.from !== range.to;\n\n        if (!isRange && range.to === state.text.length) return state;\n\n        newState.selection = isRange ? [range.to, range.to] : [range.to + 1, range.to + 1];\n\n        return newState;\n    }\n\n    static rightSelect(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        if (range.to === state.text.length) return state;\n\n        newState.selection = [range.from, range.to + 1];\n\n        return newState;\n    }\n\n    static home(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        let markup = null;\n\n        for (let i = 0; (markup = state.markups[i]); i++) {\n            if (markup[1] <= range.from && markup[2] >= range.from) {\n                break;\n            }\n        }\n\n        newState.selection = [markup[1], markup[1]];\n\n        return newState;\n    }\n\n    static homeSelect(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        let markup = null;\n\n        for (let i = 0; (markup = state.markups[i]); i++) {\n            if (markup[1] <= range.from && markup[2] >= range.from) {\n                break;\n            }\n        }\n\n        newState.selection = [markup[1], range.from];\n\n        return newState;\n    }\n\n    static end(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        let markup = null;\n\n        for (let i = 0; (markup = state.markups[i]); i++) {\n            if (markup[1] <= range.to && markup[2] >= range.to) {\n                break;\n            }\n        }\n\n        newState.selection = [markup[2], markup[2]];\n\n        return newState;\n    }\n\n    static endSelect(state, range) {\n        const newState = Util.extend(new State(), state);\n\n        let markup = null;\n\n        for (let i = 0; (markup = state.markups[i]); i++) {\n            if (markup[1] <= range.to && markup[2] >= range.to) {\n                break;\n            }\n        }\n\n        newState.selection = [range.from, markup[2]];\n\n        return newState;\n    }\n\n    static insert(state, range, characters) {\n        const newState = new State();\n        const totalDeleted = range.to - range.from;\n\n        let totalAdded = characters.length;\n        let adjustment = totalAdded - totalDeleted;\n        let collapsed = '';\n        let totalCollapsed = 0;\n\n        newState.text = state.text.slice(0, range.from) + characters + state.text.slice(range.to);\n\n        collapsed = Editor.collapseWhitespace(newState.text);\n\n        if ((totalCollapsed = newState.text.length - collapsed.length) > 0) {\n            totalAdded -= totalCollapsed;\n            adjustment -= totalCollapsed;\n\n            newState.text = collapsed;\n        }\n\n        newState.markups = Editor.adjustMarkups(state.markups, range.from, range.to, totalAdded, adjustment, newState.text);\n\n        newState.selection = [range.from + totalAdded, range.from + totalAdded];\n\n        return newState;\n    }\n\n    static collapseWhitespace(text) {\n        // Replace 3 or more spaces with a single space.\n\n        let collapsed = text.replace(/ {3,}/g, ' ');\n\n        // Replace 1 or more spaces before a new line with a single space\n\n        collapsed = text.replace(/ +\\n/g, ' \\n');\n\n        // Disallow spaces at the start of a new line\n\n        collapsed = text.replace(/\\n */g, '\\n');\n\n        return collapsed;\n    }\n\n    static backspace(state, range) {\n        const newState = new State();\n        const isRange = range.from !== range.to;\n        const fromIndex = isRange ? range.from : range.to - 1;\n\n        let adjustment = fromIndex - range.to;\n        let totalCollapsed = -1;\n        let collapsed = '';\n\n        if (range.to === 0) return state;\n\n        newState.text = state.text.slice(0, fromIndex) + state.text.slice(range.to);\n\n        collapsed = Editor.collapseWhitespace(newState.text);\n\n        if ((totalCollapsed = newState.text.length - collapsed.length) > 0) {\n            adjustment -= totalCollapsed;\n\n            newState.text = collapsed;\n        }\n\n        newState.markups = Editor.adjustMarkups(state.markups, fromIndex, range.to, 0, adjustment, newState.text);\n\n        newState.selection = [fromIndex, fromIndex];\n\n        return newState;\n    }\n\n    static delete(state, range) {\n        const newState = new State();\n        const isRange = range.from !== range.to;\n        const toIndex = isRange ? range.to : range.from + 1;\n\n        let adjustment = range.from - toIndex;\n        let totalCollapsed = -1;\n        let collapsed = '';\n\n        if (range.from === state.text.length) return state;\n\n        newState.text = state.text.slice(0, range.from) + state.text.slice(toIndex);\n\n        collapsed = Editor.collapseWhitespace(newState.text);\n\n        if ((totalCollapsed = newState.text.length - collapsed.length) > 0) {\n            adjustment -= totalCollapsed;\n\n            newState.text = collapsed;\n        }\n\n        newState.markups = Editor.adjustMarkups(state.markups, range.from, toIndex, 0, adjustment, newState.text);\n\n        newState.selection = [range.from, range.from];\n\n        return newState;\n    }\n\n    static adjustMarkups(markups, fromIndex, toIndex, totalAdded, adjustment) {\n        const newMarkups = [];\n\n        for (let i = 0, markup; (markup = markups[i]); i++) {\n            const [tag, start, end] = markup;\n            const newMarkup = new Markup(markup);\n\n            let removeMarkup = false;\n\n            if (!(markup instanceof Markup)) {\n                markup = new Markup(markup);\n            }\n\n            if (start >= fromIndex && end <= toIndex) {\n                // Selection completely envelopes markup\n\n                if (start === fromIndex && (markup.isBlock || markup.isInline && totalAdded > 0)) {\n                    // Markup should be preserved is a) is block element,\n                    // b) is inline and inserting\n                    newMarkup[2] = start + totalAdded;\n                } else if (!markup.isBlock) {\n                    removeMarkup = true;\n                }\n            } else if (start <= fromIndex && end >= toIndex) {\n                // Selection within markup or equal to markup\n\n                newMarkup[2] += adjustment;\n\n                if (markup.isInline && (start === fromIndex && fromIndex === toIndex)) {\n                    // Collapsed caret at start of inline markup\n\n                    newMarkup[1] += adjustment;\n                }\n            } else if (start >= toIndex) {\n                // Markup starts after Selection\n\n                newMarkup[1] += adjustment;\n                newMarkup[2] += adjustment;\n            } else if (fromIndex < start && toIndex > start && toIndex < end) {\n                // Selection partially envelopes markup from start\n\n                if (markup.isInline) {\n                    newMarkup[1] += (adjustment + (toIndex - start));\n                    newMarkup[2] += adjustment;\n                } else {\n                    // Previous block markup will consume this one, remove\n\n                    removeMarkup = true;\n                }\n            } else if (fromIndex > start && fromIndex < end && toIndex > end) {\n                // Selection partially envelopes markup from end\n\n                if (markup.isInline) {\n                    // Extend inline markup to end of insertion\n\n                    newMarkup[2] = fromIndex + totalAdded;\n                } else {\n                    const nextBlockMarkup = Editor.getNextBlockMarkup(markups, i);\n\n                    // Extend block markup to end of next block +/- adjustment\n\n                    newMarkup[2] = nextBlockMarkup[2] + adjustment;\n                }\n            }\n\n            if (!removeMarkup) {\n                newMarkups.push(newMarkup);\n            }\n        }\n\n        return newMarkups;\n    }\n\n    static getNextBlockMarkup(markups, index) {\n        for (let i = index + 1, markup; (markup = markups[i]); i++) {\n            if (!(markup instanceof Markup)) {\n                markup = new Markup(markup);\n            }\n\n            if (markup.isBlock) {\n                return markup;\n            }\n        }\n\n        return null;\n    }\n}\n\nexport default Editor;\n\n\n// WEBPACK FOOTER //\n// ./src/Editor.js","import Node from './models/Node';\n\nclass TreeBuilder {\n    /**\n     * @param   {Node}            root\n     * @param   {string}          text\n     * @param   {Array.<Markup>}  markups\n     * @return  {void}\n     */\n\n    static buildTreeFromRoot(root, text, markups) {\n        const openNodes = [];\n\n        let isAtLeaf = false;\n        let node = root;\n\n        node.start = 0;\n        node.end = text.length;\n\n        for (let i = 0; i <= text.length; i++) {\n            let requiresNewLeaf = false;\n\n            for (let j = 0, markup; (markup = markups[j]); j++) {\n                let closedNode = null;\n\n                if (markup[2] !== i || markup[1] === markup[2]) continue;\n\n                if (isAtLeaf && openNodes[openNodes.length - 1].isText) {\n                    const textNode = openNodes.pop();\n\n                    TreeBuilder.closeNode(textNode, i, text);\n\n                    isAtLeaf = false;\n                }\n\n                requiresNewLeaf = true;\n\n                closedNode = openNodes.pop();\n\n                TreeBuilder.closeNode(closedNode, i);\n\n                node = closedNode.parent;\n            }\n\n            for (let j = 0, markup; (markup = markups[j]); j++) {\n                let newNode = null;\n\n                if (markup[1] !== i) continue;\n\n                if (isAtLeaf) {\n                    const textNode = openNodes.pop();\n\n                    TreeBuilder.closeNode(textNode, i, text);\n\n                    isAtLeaf = false;\n                }\n\n                newNode = TreeBuilder.getOpenNode(markup[0], i, node);\n\n                openNodes.push(newNode);\n\n                node.childNodes.push(newNode);\n\n                node = newNode;\n\n                requiresNewLeaf = true;\n\n                if (markup[1] === markup[2]) {\n                    // Empty tag, close immediately\n\n                    TreeBuilder.closeNode(node, i);\n                }\n            }\n\n            if (requiresNewLeaf) {\n                const leaf = TreeBuilder.getOpenNode('', i, node);\n\n                if (node.start === node.end) {\n                    // Empty leaf in empty node, close immediately\n\n                    node.childNodes.push(leaf);\n\n                    TreeBuilder.closeNode(leaf, i);\n\n                    node = node.parent;\n\n                    openNodes.pop();\n                } else if (i < text.length) {\n                    // Should open leaf node, but not at end of string\n\n                    node.childNodes.push(leaf);\n\n                    openNodes.push(leaf);\n\n                    isAtLeaf = true;\n                }\n\n                requiresNewLeaf = false;\n            }\n        }\n    }\n\n    /**\n     * @param   {string}    tag\n     * @param   {number}    i\n     * @param   {Node}      parent\n     * @return  {Node}\n     */\n\n    static getOpenNode(tag, start, parent) {\n        const node = new Node();\n\n        node.tag    = tag;\n        node.parent = parent;\n        node.start  = start;\n        node.path   = parent.path.slice();\n\n        node.path.push(parent.childNodes.length);\n\n        return node;\n    }\n\n    /**\n     * @param   {Node}      node\n     * @param   {number}    end\n     * @param   {string}    [text='']\n     * @return  {void}\n     */\n\n    static closeNode(node, end, text='') {\n        node.end = end;\n\n        if (node.isText) {\n            node.text = text.slice(node.start, node.end);\n        }\n    }\n}\n\nexport default TreeBuilder;\n\n\n// WEBPACK FOOTER //\n// ./src/TreeBuilder.js","class Renderer {\n    static renderNodes(nodes, parent=null) {\n        return nodes.map(node => Renderer.renderNode(node, parent)).join('');\n    }\n\n    static renderNode(node, parent) {\n        let html = '';\n\n        if (node.tag) {\n            html += '<' + node.tag + '>';\n        }\n\n        if (node.childNodes.length) {\n            html += Renderer.renderNodes(node.childNodes, node);\n        } else {\n            // Text leaf node\n\n            html += node.text.length ? node.text : '&#8203;';\n        }\n\n        if (parent && parent.childNodes[parent.childNodes.length - 1] === node && html.match(/ $/)) {\n            html += '&#8203;';\n        }\n\n        if (node.tag) {\n            html += '</' + node.tag + '>';\n        }\n\n        return html;\n    }\n}\n\nexport default Renderer;\n\n\n// WEBPACK FOOTER //\n// ./src/Renderer.js","module.exports = {\n\t\"text\": \"Lorem ipsum dolor sit amet.\\nConsectetur adipiscing\",\n\t\"markups\": [\n\t\t[\n\t\t\t\"p\",\n\t\t\t0,\n\t\t\t27\n\t\t],\n\t\t[\n\t\t\t\"em\",\n\t\t\t6,\n\t\t\t17\n\t\t],\n\t\t[\n\t\t\t\"strong\",\n\t\t\t12,\n\t\t\t17\n\t\t],\n\t\t[\n\t\t\t\"h2\",\n\t\t\t28,\n\t\t\t50\n\t\t]\n\t]\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./tests/data.json\n// module id = 13\n// module chunks = 0"],"sourceRoot":""}