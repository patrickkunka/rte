{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap e5a14ed6d246da12fae8","webpack:///./src/factory.js","webpack:///./src/RichTextEditor.js","webpack:///./src/Config.js","webpack:///./src/Dom.js","webpack:///./src/Util.js","webpack:///./src/models/Formatlet.js","webpack:///./src/data.json","webpack:///./src/models/Node.js","webpack:///./src/TreeBuilder.js","webpack:///./src/Renderer.js","webpack:///./src/models/Caret.js","webpack:///./src/models/Range.js"],"names":["factory","el","configRaw","richTextEditor","attach","text","format","module","exports","RichTextEditor","dom","config","root","extend","transformData","render","bindEvents","map","start","end","length","buildTree","console","log","innerHTML","renderNodes","childNodes","addEventListener","handleKeypress","bind","e","selection","window","getSelection","range","getRangeFromSelection","characters","key","newCaretOffset","insertCharacters","from","offset","positionCaretByPathAndOffset","path","preventDefault","node","unshift","index","parentElement","i","anchorPath","getPathFromNode","anchorNode","virtualAnchorNode","getNodeByPath","to","extentPath","virtualExtentNode","isRtl","isCollapsed","extentNode","extentOffset","anchorOffset","document","createRange","setStart","collapse","removeAllRanges","addRange","Config","Object","seal","Dom","Util","target","source","deep","sourceKeys","TypeError","Array","isArray","push","keys","descriptor","getOwnPropertyDescriptor","get","arr","reduce","prev","curr","concat","fn","interval","immediate","timeoutId","args","arguments","later","apply","clearTimeout","setTimeout","last","now","Date","difference","Infinity","selector","includeSelf","parent","parentNode","matches","body","selectors","split","childSelectors","children","tempId","id","pop","querySelectorAll","join","removeAttribute","includeNonElements","previousSibling","previousElementSibling","Formatlet","tag","Node","TreeBuilder","formattings","startIndex","lastSibling","formatting","getNode","lastIndex","slice","Renderer","nodes","renderNode","html","Caret","Range"],"mappings":"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","file":"rte.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rte\"] = factory();\n\telse\n\t\troot[\"rte\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e5a14ed6d246da12fae8","import RichTextEditor from './RichTextEditor';\nimport data           from './data.json';\n\nfunction factory(el, configRaw) {\n    const richTextEditor = new RichTextEditor();\n\n    richTextEditor.attach(el, configRaw || {\n        text: data.text,\n        format: data.format\n    });\n\n    return richTextEditor;\n}\n\nmodule.exports = factory;\n\n\n// WEBPACK FOOTER //\n// ./src/factory.js","import Config       from './Config';\nimport Dom          from './Dom';\nimport Util         from './Util';\nimport Formatlet    from './models/Formatlet';\nimport Node         from './models/Node';\nimport Caret        from './models/Caret';\nimport Range        from './models/Range';\nimport TreeBuilder  from './TreeBuilder';\nimport Renderer     from './Renderer';\n\nclass RichTextEditor {\n    constructor() {\n        this.dom    = new Dom();\n        this.config = new Config();\n        this.root   = null;\n    }\n\n    attach(el, configRaw) {\n        this.dom.root = el;\n\n        Util.extend(this.config, configRaw);\n\n        this.transformData();\n\n        this.render();\n\n        this.bindEvents();\n    }\n\n    transformData() {\n        const text = this.config.text;\n        const format = this.config.format.map(format => new Formatlet(format));\n\n        this.root = new Node();\n\n        this.root.start = 0;\n        this.root.end = text.length - 1;\n\n        TreeBuilder.buildTree(text, format, this.root);\n\n        console.log(this.root);\n    }\n\n    render() {\n        this.dom.root.innerHTML = Renderer.renderNodes(this.root.childNodes);\n    }\n\n    bindEvents() {\n        this.dom.root.addEventListener('keypress', this.handleKeypress.bind(this));\n    }\n\n    handleKeypress(e) {\n        const selection = window.getSelection();\n        const range = this.getRangeFromSelection(selection);\n        const characters = e.key;\n\n        let newCaretOffset = -1;\n\n        TreeBuilder.insertCharacters(e.key, range);\n\n        this.render();\n\n        // position cursor at end of \"to\" offset (move out of class)\n\n        newCaretOffset = range.from.offset + characters.length;\n\n        this.positionCaretByPathAndOffset(range.from.path, newCaretOffset);\n\n        e.preventDefault();\n    }\n\n    getPathFromNode(node) {\n        const path = [];\n\n        while (node && node !== this.dom.root) {\n            path.unshift(Util.index(node, true));\n\n            node = node.parentElement;\n        }\n\n        return path;\n    }\n\n    getNodeByPath(path, root) {\n        let node = root;\n        let index = -1;\n        let i = 0;\n\n        console.log(path, node);\n\n        while (typeof (index = path[i]) === 'number') {\n            node = node.childNodes[index];\n\n            i++;\n        }\n\n        return node || null;\n    }\n\n    getRangeFromSelection(selection) {\n        const anchorPath = this.getPathFromNode(selection.anchorNode);\n        const virtualAnchorNode = this.getNodeByPath(anchorPath, this.root);\n        const from = new Caret();\n        const to = new Caret();\n\n        let extentPath = anchorPath;\n        let virtualExtentNode = virtualAnchorNode;\n        let isRtl = false;\n\n        if (!selection.isCollapsed) {\n            extentPath = this.getPathFromNode(selection.extentNode);\n            virtualExtentNode = this.getNodeByPath(extentPath, this.root);\n        }\n\n        isRtl = extentPath < anchorPath;\n\n        from.node   = to.node = isRtl ? virtualExtentNode : virtualAnchorNode;\n        from.offset = to.offset = isRtl ? selection.extentOffset : selection.anchorOffset;\n        from.path   = to.path = isRtl ? extentPath : anchorPath;\n\n        if (!selection.isCollapsed) {\n            to.node     = isRtl ? virtualAnchorNode : virtualExtentNode;\n            to.offset   = isRtl ? selection.anchorOffset : selection.extentOffset;\n            to.path     = isRtl ? anchorPath : extentPath;\n        }\n\n        return new Range(from, to);\n    }\n\n    positionCaretByPathAndOffset(path, offset) {\n        const range = document.createRange();\n        const node = this.getNodeByPath(path, this.dom.root);\n        const selection = window.getSelection();\n\n        range.setStart(node, offset);\n        range.collapse(true);\n\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n}\n\nexport default RichTextEditor;\n\n\n// WEBPACK FOOTER //\n// ./src/RichTextEditor.js","class Config {\n    constructor() {\n        this.text = '';\n        this.format = [];\n\n        Object.seal(this);\n    }\n}\n\nexport default Config;\n\n\n// WEBPACK FOOTER //\n// ./src/Config.js","class Dom {\n    constructor() {\n        this.root = null;\n\n        Object.seal(this);\n    }\n}\n\nexport default Dom;\n\n\n// WEBPACK FOOTER //\n// ./src/Dom.js","class Util {\n\n    /**\n     * @param   {object} target\n     * @param   {object} source\n     * @param   {boolean} deep\n     * @return  {object}\n     */\n\n    static extend(target, source, deep) {\n        let sourceKeys = [];\n\n        if (!target || typeof target !== 'object') {\n            throw new TypeError('[Util#extend] Target must be a valid object');\n        }\n\n        deep = deep || false;\n\n        if (Array.isArray(source)) {\n            for (let i = 0; i < source.length; i++) {\n                sourceKeys.push(i);\n            }\n        } else if (source) {\n            sourceKeys = Object.keys(source);\n        }\n\n        for (let i = 0; i < sourceKeys.length; i++) {\n            let key = sourceKeys[i];\n            let descriptor = Object.getOwnPropertyDescriptor(source, key);\n\n            // Skip computed properties\n\n            if (typeof descriptor.get === 'function') continue;\n\n            if (!deep || typeof source[key] !== 'object') {\n                // All non-object primitives, or all properties if\n                // shallow extend\n\n                target[key] = source[key];\n            } else if (Array.isArray(source[key])) {\n                // Arrays\n\n                if (!target[key]) {\n                    target[key] = [];\n                }\n\n                this.extend(target[key], source[key], deep);\n            } else {\n                // Objects\n\n                if (!target[key]) {\n                    target[key] = {};\n                }\n\n                this.extend(target[key], source[key], deep);\n            }\n        }\n\n        return target;\n    }\n\n    /**\n     * Flattens an array.\n     *\n     * @param {Array} arr\n     * @return {Array}\n     */\n\n    static flattenArray(arr) {\n        return arr.reduce((prev, curr) => {\n            if (Array.isArray(curr)) {\n                return prev.concat(curr);\n            }\n\n            prev.push(curr);\n\n            return prev;\n        }, []);\n    }\n\n    /**\n     * Returns a function which calls the provided function\n     * only after the specified interval has elapsed between\n     * function calls. An optional `immediate` boolean will\n     * cause the provided function to be called once immediately\n     * before waiting.\n     *\n     * @param   {function}  fn\n     * @param   {number}    interval\n     * @param   {boolean}   [immediate=false]\n     * @return  {function}\n     */\n\n    static debounce(fn, interval, immediate) {\n        let timeoutId = -1;\n\n        return function() {\n            const args = arguments;\n\n            const later = () => {\n                timeoutId = -1;\n\n                fn.apply(this, args); // eslint-disable-line no-invalid-this\n            };\n\n            if (timeoutId < 0 && immediate) {\n                later();\n            } else {\n                clearTimeout(timeoutId);\n\n                timeoutId = setTimeout(later, interval);\n            }\n        };\n    }\n\n    /**\n     * Returns a function which calls the provided function once per maximum\n     * specified interval.\n     *\n     * @param   {function}  fn\n     * @param   {number}    interval\n     * @return  {function}\n     */\n\n    static throttle(fn, interval) {\n        let timeoutId = -1;\n        let last = -1;\n\n        return function() {\n            const args = arguments;\n            const now = Date.now();\n            const difference = last ? now - last : Infinity;\n\n            const later = () => {\n                last = now;\n\n                fn.apply(this, args); // eslint-disable-line no-invalid-this\n            };\n\n            if (!last || difference >= interval) {\n                later();\n            } else {\n                clearTimeout(timeoutId);\n\n                timeoutId = setTimeout(later, interval - difference);\n            }\n        };\n    }\n\n    /**\n     * @param   {HTMLElement}       el\n     * @param   {string}            selector\n     * @param   {boolean}           [includeSelf]\n     * @return  {HTMLElement|null}\n     */\n\n    static closestParent(el, selector, includeSelf) {\n        let parent = el.parentNode;\n\n        if (includeSelf && el.matches(selector)) {\n            return el;\n        }\n\n        while (parent && parent !== document.body) {\n            if (parent.matches && parent.matches(selector)) {\n                return parent;\n            } else if (parent.parentNode) {\n                parent = parent.parentNode;\n            } else {\n                return null;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * @param   {Element}     el\n     * @param   {string}      selector\n     * @return  {Element[]}\n     */\n\n    static children(el, selector) {\n        const selectors = selector.split(',');\n        const childSelectors = [];\n\n        let children = null;\n        let tempId   = '';\n\n        if (!el.id) {\n            tempId = '_temp_';\n\n            el.id = tempId;\n        }\n\n        while (selectors.length) {\n            childSelectors.push('#' + el.id + '>' + selectors.pop());\n        }\n\n        children = document.querySelectorAll(childSelectors.join(', '));\n\n        if (tempId) {\n            el.removeAttribute('id');\n        }\n\n        return children;\n    }\n\n    /**\n     * @param   {Node}        node\n     * @param   {boolean}     [includeNonElements=false]\n     * @return  {Element[]}\n     */\n\n    static index(node, includeNonElements=false) {\n        let index = 0;\n\n        while ((node = includeNonElements ? node.previousSibling : node.previousElementSibling) !== null) {\n            index++;\n        }\n\n        return index;\n    }\n}\n\nexport default Util;\n\n\n// WEBPACK FOOTER //\n// ./src/Util.js","class Formatlet {\n    constructor([tag, start, end]) {\n        this.tag    = tag;\n        this.start  = start;\n        this.end    = end;\n\n        Object.seal(this);\n    }\n}\n\nexport default Formatlet;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Formatlet.js","module.exports = {\n\t\"text\": \"Lorem ipsum dolor sit amet. Consectetur adipiscing\",\n\t\"format\": [\n\t\t[\n\t\t\t\"p\",\n\t\t\t0,\n\t\t\t26\n\t\t],\n\t\t[\n\t\t\t\"em\",\n\t\t\t6,\n\t\t\t16\n\t\t],\n\t\t[\n\t\t\t\"strong\",\n\t\t\t12,\n\t\t\t16\n\t\t],\n\t\t[\n\t\t\t\"h2\",\n\t\t\t28,\n\t\t\t50\n\t\t]\n\t]\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/data.json\n// module id = 6\n// module chunks = 0","class Node {\n    constructor() {\n        this.childNodes = [];\n        this.start      = -1;\n        this.end        = -1;\n        this.tag        = '';\n        this.text       = '';\n\n        Object.seal(this);\n    }\n}\n\nexport default Node;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Node.js","import Node from './models/Node';\n\nclass TreeBuilder {\n    static buildTree(text, formattings, parent, startIndex=0) {\n        let lastSibling = null;\n\n        for (let i = startIndex; i < formattings.length; i++) {\n            const formatting = formattings[i];\n\n            if (lastSibling && formatting.end <= lastSibling.end) {\n                // Recurse down\n\n                lastSibling.childNodes.length = 0;\n\n                i = TreeBuilder.buildTree(text, formattings, lastSibling, i);\n            } else if (formatting.start > parent.end) {\n                // Return up\n\n                if (lastSibling.end < parent.end) {\n                    // Preceeded by text node\n\n                    parent.childNodes.push(TreeBuilder.getNode('', lastSibling.end + 1, parent.end, text));\n                }\n\n                return i - 1;\n            } else {\n                const lastIndex = lastSibling ? lastSibling.end + 1 : parent.start;\n\n                // First child or sibling\n\n                if (formatting.start > lastIndex) {\n                    // Preceeded by text node\n\n                    parent.childNodes.push(TreeBuilder.getNode('', lastIndex, formatting.start - 1, text));\n                }\n\n                lastSibling = TreeBuilder.getNode(formatting.tag, formatting.start, formatting.end, text);\n\n                // Create internal text node\n\n                lastSibling.childNodes.push(TreeBuilder.getNode('', formatting.start, formatting.end, text));\n\n                parent.childNodes.push(lastSibling);\n            }\n        }\n    }\n\n    static getNode(tag, start, end, text) {\n        const node = new Node();\n\n        node.tag = tag;\n        node.start = start;\n        node.end = end;\n\n        if (!tag) {\n            node.text = text.slice(start, end + 1);\n        }\n\n        return node;\n    }\n\n    static insertCharacters(characters, range) {\n        if (range.from.node === range.to.node) {\n            const node = range.from.node;\n\n\n            // Same node\n\n            node.text = node.text.slice(0, range.from.offset) + characters + node.text.slice(range.to.offset);\n        }\n\n        // TODO: increment all start/end values in subsequent nodes\n\n        // TODO: return closest common ancestor node for re-rendering (not in this class)\n    }\n}\n\nexport default TreeBuilder;\n\n\n// WEBPACK FOOTER //\n// ./src/TreeBuilder.js","class Renderer {\n    static renderNodes(nodes) {\n        return nodes.map(Renderer.renderNode).join('');\n    }\n\n    static renderNode(node) {\n        let html = '';\n\n        if (node.tag) {\n            html += '<' + node.tag + '>';\n        }\n\n        if (node.childNodes.length) {\n            html += Renderer.renderNodes(node.childNodes);\n        } else {\n            html += node.text;\n        }\n\n        if (node.tag) {\n            html += '</' + node.tag + '>';\n        }\n\n        return html;\n    }\n}\n\nexport default Renderer;\n\n\n// WEBPACK FOOTER //\n// ./src/Renderer.js","class Caret {\n    constructor() {\n        this.path = null;\n        this.node = null;\n        this.offset = null;\n\n        Object.seal(this);\n    }\n}\n\nexport default Caret;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Caret.js","class Range {\n    constructor(from, to) {\n        this.from = from;\n        this.to = to;\n\n        Object.seal(this);\n    }\n}\n\nexport default Range;\n\n\n// WEBPACK FOOTER //\n// ./src/models/Range.js"],"sourceRoot":""}