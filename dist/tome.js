!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tome=t():e.tome=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.P="p",e.TEXT="#text",e.BLOCK_BREAK="\n\n",e.LINE_BREAK="\n",e.STRONG="strong",e.EM="em",e.BR="br"}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.extend=function(e,t,n){var r=[];if(!e||"object"!=typeof e)throw new TypeError("[Util#extend] Target must be a valid object");if(n=n||!1,Array.isArray(t))for(var o=0;o<t.length;o++)r.push(o);else t&&(r=Object.keys(t));for(var o=0;o<r.length;o++){var i=r[o];"function"!=typeof Object.getOwnPropertyDescriptor(t,i).get&&(n&&"object"==typeof t[i]?Array.isArray(t[i])?(e[i]||(e[i]=[]),this.extend(e[i],t[i],n)):(e[i]||(e[i]={}),this.extend(e[i],t[i],n)):e[i]=t[i])}return e},e.flattenArray=function(e){return e.reduce(function(e,t){return Array.isArray(t)?e.concat(t):(e.push(t),e)},[])},e.debounce=function(e,t,n){var r=-1;return function(){var o=this,i=arguments,a=function(){r=-1,e.apply(o,i)};r<0&&n?a():(clearTimeout(r),r=setTimeout(a,t))}},e.throttle=function(e,t){var n=-1,r=-1;return function(){var o=this,i=arguments,a=Date.now(),u=r?a-r:1/0,s=function(){r=a,e.apply(o,i)};!r||u>=t?s():(clearTimeout(n),n=setTimeout(s,t-u))}},e.closestParent=function(e,t,n){var r=e.parentNode;if(n&&e.matches(t))return e;for(;r&&r!==document.body;){if(r.matches&&r.matches(t))return r;if(!r.parentNode)return null;r=r.parentNode}return null},e.children=function(e,t){var n=t.split(","),r=[],o=null,i="";for(e.id||(i="_temp_",e.id=i);n.length;)r.push("#"+e.id+">"+n.pop());return o=document.querySelectorAll(r.join(", ")),i&&e.removeAttribute("id"),o},e.index=function(e,t){void 0===t&&(t=!1);for(var n=0;null!==(e=t?e.previousSibling:e.previousElementSibling);)n++;return n},e.camelCase=function(e){return e.toLowerCase().replace(/([_-][a-z0-9])/g,function(e){return e.toUpperCase().replace(/[_-]/,"")})},e.pascalCase=function(t){return(t=e.camelCase(t)).charAt(0).toUpperCase()+t.slice(1)},e.dashCase=function(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()},e.isGreaterPath=function(e,t){for(var n=0,r=e[n],o=t[n];"number"==typeof r&&"number"==typeof o;){if(r>o)return!0;n++,r=e[n],o=t[n]}return!1},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=function(){function e(){this.text="",this.markups=[],this.selection=new r.default,this.activeBlockMarkup=null,this.activeInlineMarkups=[],this.envelopedBlockMarkups=[],Object.seal(this)}return Object.defineProperty(e.prototype,"length",{get:function(){return this.text.length},enumerable:!0,configurable:!0}),e.prototype.isTagActive=function(e){for(var t=0,n=void 0;n=this.activeInlineMarkups[t];t++)if(n[0]===e)return!0;return!1},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e.SET_SELECTION="SET_SELETION",e.INSERT="INSERT",e.BACKSPACE="BACKSPACE",e.DELETE="DELETE",e.RETURN="RETURN",e.SHIFT_RETURN="SHIFT_RETURN",e.TOGGLE_INLINE="TOGGLE_INLINE",e.UNDO="UNDO",e.REDO="REDO",e.NONE="NONE"}(r||(r={})),t.default=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(11),a=function(e){function t(t){var n=t[0],r=t[1],o=t[2],i=e.call(this)||this;return i[0]=null,i[1]=null,i[2]=null,i[0]=n,i[1]=r,i[2]=o,Object.seal(i),i}return r(t,e),Object.defineProperty(t.prototype,"tag",{get:function(){return this[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){return this[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return[o.default.H1,o.default.H2,o.default.H3,o.default.H4,o.default.H5,o.default.H6,o.default.P].indexOf(this[0])>-1?i.default.BLOCK:i.default.INLINE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlock",{get:function(){return this.type===i.default.BLOCK},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInline",{get:function(){return this.type===i.default.INLINE},enumerable:!0,configurable:!0}),t}(Array);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function e(){this.childNodes=[],this.parent=null,this.start=-1,this.end=-1,this.tag=null,this.text="",this.path=[]}return Object.defineProperty(e.prototype,"isText",{get:function(){return this.tag===r.default.TEXT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlock",{get:function(){return[r.default.H1,r.default.H2,r.default.H3,r.default.H4,r.default.H5,r.default.H6,r.default.P].indexOf(this.tag)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInline",{get:function(){return!this.isText&&!this.isBlock},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=function(){function e(e,t,n){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=r.default.LTR),this.from=e,this.to=t,this.direction=n}return Object.defineProperty(e.prototype,"isCollapsed",{get:function(){return this.from===this.to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLtr",{get:function(){return this.direction===r.default.LTR},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRtl",{get:function(){return this.direction===r.default.RTL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this.isLtr?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this.isLtr?this.to:this.from},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(r||(r={})),t.default=r},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t={}),new o.default(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(9);t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=n(1),i=n(4),a=n(5),u=n(12),s=n(6),l=n(2),f=n(13),d=n(14),c=n(16),p=n(18),h=n(19),v=n(20),g=n(3),y=n(7),b=function(){function e(e,t){this.dom=new r.default,this.eventHandler=new c.default(this),this.config=new d.default,this.root=null,this.history=[],this.historyIndex=-1,Object.defineProperties(this,{state:{get:function(){return this.history[this.historyIndex]}}}),this.init(e,t)}return e.prototype.init=function(e,t){o.default.extend(this.config,t,!0),e.contentEditable||(e.contentEditable=!0),this.dom.root=e,this.history.push(this.buildInitialState(this.config.value)),this.historyIndex++,this.render(),this.eventHandler.bindEvents(this.dom.root,this)},e.prototype.buildInitialState=function(e){var t=o.default.extend(new l.default,e);return t.markups.length<1&&t.markups.push(["p",0,0]),t.markups=t.markups.map(function(e){return new i.default(e)}),t},e.prototype.render=function(){this.root=e.buildModelFromState(this.state),this.dom.root.innerHTML=h.default.renderNodes(this.root.childNodes)},e.prototype.undo=function(){if(1!==this.historyIndex){var e=this.config.callbacks.onStateChange;this.historyIndex--,this.render(),this.positionCaret(this.state.selection),"function"==typeof e&&e(this.state,g.default.UNDO)}},e.prototype.redo=function(){if(this.history.length-1!==this.historyIndex){var e=this.config.callbacks.onStateChange;this.historyIndex++,this.render(),this.positionCaret(this.state.selection),"function"==typeof e&&e(this.state,g.default.REDO)}},e.prototype.applyAction=function(e){var t=Object.assign(new f.default,e),n=this.config.callbacks.onStateChange;if(t.type===g.default.SET_SELECTION){var r=window.getSelection();if(!r.anchorNode||!this.dom.root.contains(r.anchorNode))return;t.range=this.getRangeFromSelection(r)}else t.range=this.state.selection;var o=[t].reduce(v.default,this.state);if(!(o instanceof l.default))throw new TypeError('[RichTextEditor] Action type "'+t.type.toString()+'" did not return a valid state object');o!==this.state&&(Object.freeze(o),Object.freeze(o.markups),Object.freeze(o.activeInlineMarkups),Object.freeze(o.envelopedBlockMarkups),this.history.length=this.historyIndex+1,this.history.push(o),this.historyIndex++,t.type!==g.default.SET_SELECTION&&(this.render(),this.positionCaret(this.state.selection)),"function"==typeof n&&n(this.state,t.type))},e.prototype.getPathFromNode=function(e){for(var t=[];e&&e!==this.dom.root;)t.unshift(o.default.index(e,!0)),e=e.parentElement;return t},e.prototype.getNodeByPath=function(e,t){for(var n=t,r=-1,o=0;"number"==typeof(r=e[o]);)n=n.childNodes[r],o++;return n||null},e.prototype.getRangeFromSelection=function(e){var t=this.getPathFromNode(e.anchorNode),n=this.getNodeByPath(t,this.root),r=new u.default,i=new u.default,a=t,l=n,f=!1,d=-1,c=-1;return e.isCollapsed||(a=this.getPathFromNode(e.extentNode),l=this.getNodeByPath(a,this.root)),f=o.default.isGreaterPath(t,a)||!o.default.isGreaterPath(a,t)&&e.anchorOffset>e.extentOffset,r.node=i.node=f?l:n,r.offset=i.offset=f?e.extentOffset:e.anchorOffset,r.path=i.path=f?a:t,e.isCollapsed||(i.node=f?n:l,i.offset=f?e.anchorOffset:e.extentOffset,i.path=f?t:a),d=Math.min(r.node.start+r.offset,r.node.end),c=Math.min(i.node.start+i.offset,i.node.end),new s.default(d,c,f?y.default.RTL:y.default.LTR)},e.prototype.positionCaret=function(e){for(var t=e.from,n=e.to,r=e.isRtl,o=document.createRange(),i=window.getSelection(),a=this.root.childNodes,u=null,s=null,l=null,f=-1,d=-1,c=0;u=a[c];c++)if(!(u.end<t)){if(!u.childNodes.length){f=t-u.start;break}a=u.childNodes,c=-1}if(s=this.getNodeByPath(u.path,this.dom.root),o.setStart(s,f),t===n)return o.collapse(!0),i.removeAllRanges(),void i.addRange(o);a=this.root.childNodes;for(var c=0;u=a[c];c++)if(!(u.end<n)){if(!u.childNodes.length){d=n-u.start;break}a=u.childNodes,c=-1}l=this.getNodeByPath(u.path,this.dom.root),o.setEnd(l,d),i.removeAllRanges(),r?i.setBaseAndExtent(l,d,s,f):i.setBaseAndExtent(s,f,l,d)},e.buildModelFromState=function(e){var t=new a.default;return p.default.build(t,e.text,e.markups),t},e}();t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.root=null}return e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.INLINE=0]="INLINE",e[e.BLOCK=1]="BLOCK"}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.path=null,this.node=null,this.offset=null}return e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.type=null,this.range=null,this.content="",this.tag=""}return e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),o=n(2),i=function(){function e(){this.callbacks=new r.default,this.value=new o.default,Object.seal(this)}return e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.onStateChange=null,this.onValueChange=null,Object.seal(this)}return e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(3),i=n(17),a=n(0),u=function(){function e(e){this.editor=null,this.boundDelegator=null,this.editor=e,this.boundDelegator=this.delegator.bind(this)}return e.prototype.bindEvents=function(e){e.addEventListener("keypress",this.boundDelegator),e.addEventListener("keydown",this.boundDelegator),e.addEventListener("mousedown",this.boundDelegator),window.addEventListener("mouseup",this.boundDelegator)},e.prototype.unbindEvents=function(e){e.removeEventListener("keypress",this.boundDelegator),e.removeEventListener("keydown",this.boundDelegator),e.removeEventListener("click",this.boundDelegator),e.addEventListener("mousedown",this.boundDelegator),window.addEventListener("mouseup",this.boundDelegator)},e.prototype.delegator=function(e){var t=e.type,n=this["handle"+r.default.pascalCase(t)];if("function"!=typeof n)throw new Error('[EventHandler] No handler found for event "'+t+'"');n(e)},e.prototype.handleKeypress=function(e){e.preventDefault(),this.editor.applyAction({type:o.default.INSERT,content:e.key})},e.prototype.handleMouseup=function(e){this.editor.dom.root===document.activeElement&&this.editor.applyAction({type:o.default.SET_SELECTION})},e.prototype.handleMousedown=function(e){this.editor.applyAction({type:o.default.SET_SELECTION})},e.prototype.handleKeydown=function(e){var t=this,n=e.key.toLowerCase(),r={};if(e.metaKey)switch(n){case i.default.A:r={type:o.default.SET_SELECTION};break;case i.default.B:r={type:o.default.TOGGLE_INLINE,tag:a.default.STRONG},e.preventDefault();break;case i.default.I:r={type:o.default.TOGGLE_INLINE,tag:a.default.EM},e.preventDefault();break;case i.default.Z:return e.preventDefault(),e.shiftKey?this.editor.redo():this.editor.undo()}switch(n){case i.default.ENTER:r={type:e.shiftKey?o.default.SHIFT_RETURN:o.default.RETURN},e.preventDefault();break;case i.default.BACKSPACE:r={type:o.default.BACKSPACE},e.preventDefault();break;case i.default.DELETE:r={type:o.default.DELETE},e.preventDefault();break;case i.default.ARROW_LEFT:case i.default.ARROW_RIGHT:case i.default.ARROW_UP:case i.default.ARROW_DOWN:r={type:o.default.SET_SELECTION}}r&&r.type!==o.default.NONE&&setTimeout(function(){return t.editor.applyAction(r)},10)},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e.ENTER="enter",e.BACKSPACE="backspace",e.DELETE="delete",e.ARROW_UP="arrowup",e.ARROW_DOWN="arrowdown",e.ARROW_LEFT="arrowleft",e.ARROW_RIGHT="arrowright",e.A="a",e.C="c",e.V="v",e.S="s",e.Z="z",e.B="b",e.I="i"}(r||(r={})),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(0),i=function(){function e(){}return e.build=function(t,n,r){var o=[],i=t,a=null;i.start=0,i.end=n.length;for(var u=0;u<=n.length;u++){var s=[],l=-1,f=null,d=!1,c=!1;for(l=0;(f=r[l])&&!(f[1]>u);l++)if(!(f[2]<u||o.indexOf(f)>-1)){a&&(a=e.closeTextNode(a,n,u));var p=e.createNode(f[0],i,u,f[2]);i.childNodes.push(p),o.push(f),i=p,d=!0}for(d&&(a?a=e.closeTextNode(a,n,u):(a=e.createTextNode(i,i.start),i.childNodes.push(a))),l=r.length-1;f=r[l];l--)if(f[2]===u){for(a&&(a=e.closeTextNode(a,n,u)),f[1]===f[2]&&(d=!1);o.length>0;){var h=o.pop();if(h!==f&&s.push(h),i.end=u,i=i.parent,h===f)break}c=!0}for(;s.length>0;){f=s.pop();var p=e.createNode(f[0],i,u,f[2]);i.childNodes.push(p),o.push(f),i=p,d=!0}(u!==n.length&&c&&!d||d&&!a)&&(a=e.createTextNode(i,u),i.childNodes.push(a))}},e.createTextNode=function(t,n){return e.createNode(o.default.TEXT,t,n,-1)},e.closeTextNode=function(e,t,n){return e.end=n,e.text=t.slice(e.start,e.end),null},e.createNode=function(e,t,n,o){var i=new r.default;return i.tag=e,i.parent=t,i.start=n,i.end=o,i.path=t.path.slice(),i.path.push(t.childNodes.length),i},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function e(){}return e.renderNodes=function(t,n){return void 0===n&&(n=null),t.map(function(t){return e.renderNode(t,n)}).join("")},e.renderNode=function(t,n){var o="";return t.tag!==r.default.TEXT&&(o+="<"+t.tag+">"),t.childNodes.length?o+=e.renderNodes(t.childNodes,t):o+=t.text.length?t.text:"&#8203;",n&&n.childNodes[n.childNodes.length-1]===t&&o.match(/ $/)&&(o+="&#8203;"),t.tag!==r.default.TEXT&&(o+="</"+t.tag+">"),o},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),i=n(3),a=n(21);t.default=function(e,t){switch(t.type){case i.default.SET_SELECTION:var n=o.default.extend(new r.default,e,!0);return Object.assign(n.selection,t.range),a.default.setActiveMarkups(n,t.range),n;case i.default.INSERT:return a.default.insert(e,{from:t.range.from,to:t.range.to},t.content);case i.default.BACKSPACE:var u=t.range.isCollapsed?t.range.from-1:t.range.from;return 0===t.range.to?e:a.default.insert(e,{from:u,to:t.range.to},"");case i.default.DELETE:var s=t.range.isCollapsed?t.range.from+1:t.range.to;return t.range.from===e.text.length?e:a.default.insert(e,{from:t.range.from,to:s},"");case i.default.RETURN:return a.default.insert(e,t.range,"\n");case i.default.SHIFT_RETURN:break;case i.default.TOGGLE_INLINE:var n=null;return n=e.isTagActive(t.tag)?a.default.removeInlineMarkup(e,t.tag,t.range.from,t.range.to):a.default.addInlineMarkup(e,t.tag,t.range.from,t.range.to),a.default.setActiveMarkups(n,t.range),n;default:return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(4),i=n(1),a=n(0),u=function(){function e(){}return e.insert=function(t,n,o){var i=new r.default,u=n.to-n.from,s=t.text.slice(0,n.from),l=t.text.slice(n.to),f=o.length,d=f-u,c=0;return i.text=s+o+l,i.markups=e.adjustMarkups(t.markups,n.from,n.to,f,d),o===a.default.LINE_BREAK?(i.markups=e.splitMarkups(i.markups,n.from),c=e.trimWhitespace(i,n.from)):""===o&&(i.markups=e.joinMarkups(i.markups,n.from),i.markups=e.joinMarkups(i.markups,n.to)),i.selection.from=i.selection.to=n.from+f+c,e.setActiveMarkups(i,i.selection),i},e.addInlineMarkup=function(t,n,a,u,s){void 0===s&&(s=null);var l=i.default.extend(new r.default,t,!0),f=t.envelopedBlockMarkups||[],d=-1;if(f.length>1){var c=l;return c.envelopedBlockMarkups.length=0,f.forEach(function(t,r){var o=0===r?a:t[1],i=r===f.length-1?u:t[2];c=e.addInlineMarkup(c,n,o,i,t)}),c}s=s||f[0],s&&(a=a<s[1]?s[1]:a,u=u>s[2]?s[2]:u),e.ingestMarkups(l.markups,n,a,u);for(var p=0,h=l.markups.length;p<h;p++){var v=new o.default(l.markups[p]);if(d=p,v.start>a)break;if(p===h-1){d++;break}}return l.markups.splice(d,0,[n,a,u]),e.joinMarkups(l.markups,a),e.joinMarkups(l.markups,u),l},e.removeInlineMarkup=function(t,n,o,a){var u=i.default.extend(new r.default,t,!0),s=t.envelopedBlockMarkups||[];if(s.length>1){var l=u;return l.envelopedBlockMarkups.length=0,s.forEach(function(t,r){var i=0===r?o:t.start,u=r===s.length-1?a:t.end;l=e.removeInlineMarkup(l,n,i,u)}),l}return e.ingestMarkups(u.markups,n,o,a),u},e.replaceBlockMarkup=function(){},e.adjustMarkups=function(t,n,r,i,a){for(var u=[],s=0,l=void 0;l=t[s];s++){var f=l[1],d=l[2],c=new o.default(l),p=!1;if(l instanceof o.default||(l=new o.default(l)),f>=n&&d<=r)f===n&&(l.isBlock||l.isInline&&i>0)?c[2]=f+i:(!l.isBlock||f>n)&&(p=!0);else if(f<=n&&d>=r)c[2]+=a,l.isInline&&f===n&&n===r&&(c[1]+=a);else if(f>=r)c[1]+=a,c[2]+=a;else if(n<f&&r>f&&r<d)l.isInline?(c[1]+=a+(r-f),c[2]+=a):p=!0;else if(n>f&&n<d&&r>d)if(l.isInline)c[2]=n+i;else{var h=e.getClosingBlockMarkup(t,s,r);c[2]=h[2]+a}p||u.push(c)}return u},e.getClosingBlockMarkup=function(e,t,n){for(var r=t+1,i=void 0;i=e[r];r++)if(i instanceof o.default||(i=new o.default(i)),i.isBlock&&i.start<=n&&i.end>=n)return i;return null},e.trimWhitespace=function(e,t){for(var n=0,r=0,i=-1,a=0;a<e.markups.length;a++){var u=e.markups[a];0!==n&&u[1]>=i&&(u[1]+=n,u[2]+=n);var s=new o.default(u);if(s.isBlock){var l=e.text.slice(0,s.start),f=e.text.slice(s.start,s.end),d=e.text.slice(s.end),c=f;" "===c.charAt(0)&&(i=s.start,c=c.slice(1))," "===c.charAt(c.length-1)&&(i=s.end-1,c=c.slice(0,-1));var p=c.length-f.length;0!==p&&(n+=p,s.start<t&&(r+=p),u[2]+=p,e.text=l+c+d)}}return r},e.splitMarkups=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=new o.default(r),u=null;if(i.start<t&&i.end>t){var s=t+1,l=i.isBlock&&i.end===s?a.default.P:i.tag,f=n+1,d=-1;for(r[2]=t,u=new o.default([l,s,i.end]);f<e.length;f++){var c=new o.default(e[f]);if(c.start===s){d=u.isBlock?f:f+1;break}if(c.start>s){d=f;break}}e.splice(d,0,u),d===f&&(n=d)}}return e},e.joinMarkups=function(e,t){for(var n={},r=null,i=0;i<e.length;i++){var a=new o.default(e[i]);if(a.end===t)a.isBlock?r=e[i]:n[a.tag]=e[i];else if(a.start===t){var u=null;a.isBlock&&r?u=r:a.isInline&&n[a.tag]&&(u=n[a.tag]),u&&(u[2]=a[2],e.splice(i,1),i--)}else if(a.start>t)break}return e},e.ingestMarkups=function(e,t,n,r){for(var o=0,i=void 0;i=e[o];o++){var a=i[0],u=i[1],s=i[2];if(a===t)if(u>=n&&s<=r)e.splice(o,1),o--;else if(u<n&&s>=r){if(s>r){var l=[a,r,s];e.splice(o+1,0,l),o++}i[2]=n}else u>n&&u<r?i[1]=r:u===n&&s>r&&(i[1]=r)}},e.setActiveMarkups=function(e,t){e.activeBlockMarkup=null,e.activeInlineMarkups.length=e.envelopedBlockMarkups.length=0;for(var n=[],r=null,i=0;i<e.markups.length;i++){var a=new o.default(e.markups[i]),u=n[n.length-1];if(a.start<=t.from&&a.end>=t.from)if(a.isBlock)e.activeBlockMarkup=a;else if(a.end>=t.to)e.activeInlineMarkups.push(a);else if(a.end===r.end){n.push(a);continue}u&&u.tag===a.tag&&(a.start===r.start&&a.end>=t.to||a.start===r.start&&a.end===r.end)?(n.push(a),t.to<=a.end&&(s=e.activeInlineMarkups).push.apply(s,n)):a.isInline&&(n.length=0),a.isBlock&&(r=a,(t.from>=a.start&&t.from<a.end||t.to>a.start&&t.to<=a.end||t.from<=a.start&&t.to>=a.end)&&e.envelopedBlockMarkups.push(a))}var s},e}();t.default=u}])});